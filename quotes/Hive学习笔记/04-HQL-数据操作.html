<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.json',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="插入数据insert into显式字段插入：123456789101112131415161718192021222324hive&amp;gt; insert into users(id,name) values(1,&amp;apos;aa&amp;apos;);WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versi">
<meta property="og:type" content="website">
<meta property="og:title" content="JJT-个人Wiki">
<meta property="og:url" content="https:&#x2F;&#x2F;hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com&#x2F;quotes&#x2F;Hive%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0&#x2F;04-HQL-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C.html">
<meta property="og:site_name" content="JJT-个人Wiki">
<meta property="og:description" content="插入数据insert into显式字段插入：123456789101112131415161718192021222324hive&amp;gt; insert into users(id,name) values(1,&amp;apos;aa&amp;apos;);WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versi">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-12-15T11:07:33.016Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com/quotes/Hive%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/04-HQL-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>

  <title> | JJT-个人Wiki
  </title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JJT-个人Wiki</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">you see see you one day day</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content">
            

  <div class="posts-expand">
    
    
    
    <div class="post-block" lang="zh-CN">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">
</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/Hive%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">HIVE学习笔记</a></li>
            <li>04-HQL-数据操作</li>
          
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
          <h1>插入数据</h1><h2 id="insert-into">insert into</h2><p>显式字段插入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert into users(id,name) values(1,<span class="string">'aa'</span>);</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170810094706_d75cb718-9742-4b25-864c-44a63c27d064</span><br><span class="line">Total jobs = 3</span><br><span class="line">Launching Job 1 out of 3</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502371586068_0001, Tracking URL = http://node1:8088/proxy/application_1502371586068_0001/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502371586068_0001</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-10 09:47:34,602 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-10 09:47:50,211 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.36 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 360 msec</span><br><span class="line">Ended Job = job_1502371586068_0001</span><br><span class="line">Stage-4 is selected by condition resolver.</span><br><span class="line">Stage-3 is filtered out by condition resolver.</span><br><span class="line">Stage-5 is filtered out by condition resolver.</span><br><span class="line">Moving data to directory hdfs://cetc/user/hive/warehouse/users/.hive-staging_hive_2017-08-10_09-47-06_012_378591815767107640-1/-ext-10000</span><br><span class="line">Loading data to table default.users</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1   Cumulative CPU: 2.36 sec   HDFS Read: 4225 HDFS Write: 92 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 360 msec</span><br><span class="line">OK</span><br><span class="line">Time taken: 46.216 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure><a id="more"></a>



<p>隐式字段插入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert into users values(2,<span class="string">'bb'</span>);</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170810095011_cf3ab969-c1bb-459b-a1eb-f9b411ec0614</span><br><span class="line">Total jobs = 3</span><br><span class="line">Launching Job 1 out of 3</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502371586068_0002, Tracking URL = http://node1:8088/proxy/application_1502371586068_0002/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502371586068_0002</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-10 09:50:28,186 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-10 09:50:41,103 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.34 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 340 msec</span><br><span class="line">Ended Job = job_1502371586068_0002</span><br><span class="line">Stage-4 is selected by condition resolver.</span><br><span class="line">Stage-3 is filtered out by condition resolver.</span><br><span class="line">Stage-5 is filtered out by condition resolver.</span><br><span class="line">Moving data to directory hdfs://cetc/user/hive/warehouse/users/.hive-staging_hive_2017-08-10_09-50-11_441_8940366110116441398-1/-ext-10000</span><br><span class="line">Loading data to table default.users</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1   Cumulative CPU: 2.34 sec   HDFS Read: 4228 HDFS Write: 92 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 340 msec</span><br><span class="line">OK</span><br><span class="line">Time taken: 32.393 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>插入多条记录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert into users values(3,<span class="string">'cc'</span>),(4,<span class="string">'dd'</span>),(5,<span class="string">'ee'</span>);</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170810095507_48fc0ce3-7789-4427-b35c-3809586f208f</span><br><span class="line">Total jobs = 3</span><br><span class="line">Launching Job 1 out of 3</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502371586068_0003, Tracking URL = http://node1:8088/proxy/application_1502371586068_0003/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502371586068_0003</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-10 09:55:24,363 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-10 09:55:36,294 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.35 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 350 msec</span><br><span class="line">Ended Job = job_1502371586068_0003</span><br><span class="line">Stage-4 is selected by condition resolver.</span><br><span class="line">Stage-3 is filtered out by condition resolver.</span><br><span class="line">Stage-5 is filtered out by condition resolver.</span><br><span class="line">Moving data to directory hdfs://cetc/user/hive/warehouse/users/.hive-staging_hive_2017-08-10_09-55-07_839_6570192849374755881-1/-ext-10000</span><br><span class="line">Loading data to table default.users</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1   Cumulative CPU: 2.35 sec   HDFS Read: 4238 HDFS Write: 138 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 350 msec</span><br><span class="line">OK</span><br><span class="line">Time taken: 31.315 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>Hive每次向表中插入一条记录，都会转换为MapReduce程序，效率低下。</p>
<h2 id="insert-overwrite">insert overwrite</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert overwrite table account2 select id,age,name from account_tmp;</span></span><br></pre></td></tr></table></figure>
<h2 id="insert-into和insert-overowrite的区别">insert into和insert overowrite的区别</h2>
<p>insert into与 insert overwrite都可以向hive表中插入数据，但是insert into直接追加到表中数据的尾部，而insert overwrite会重写数据，既先删除已有数据，再写入。如果存在分区的情况，insert overwrite会只重写当前分区数据。</p>
<h1>简单查询</h1>
<p>字段查询：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select id,name from users;</span></span><br><span class="line">OK</span><br><span class="line">1   aa                  </span><br><span class="line">2   bb                  </span><br><span class="line">3   cc                  </span><br><span class="line">4   dd                  </span><br><span class="line">5   ee                  </span><br><span class="line">Time taken: 0.224 seconds, Fetched: 5 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>条件查询：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from users <span class="built_in">where</span> id=1;</span></span><br><span class="line">OK</span><br><span class="line">1   aa                  </span><br><span class="line">Time taken: 0.399 seconds, Fetched: 1 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select name from users <span class="built_in">where</span> name like <span class="string">'%a'</span>;</span></span><br><span class="line">OK</span><br><span class="line">aa                  </span><br><span class="line">Time taken: 0.214 seconds, Fetched: 1 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>统计查询：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select count(*) from users;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170810095858_fa356df4-8b18-4a5b-835a-643427dd99f6</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks determined at compile time: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502371586068_0004, Tracking URL = http://node1:8088/proxy/application_1502371586068_0004/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502371586068_0004</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2017-08-10 09:59:21,494 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-10 09:59:31,484 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.02 sec</span><br><span class="line">2017-08-10 09:59:43,424 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 4.11 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 4 seconds 110 msec</span><br><span class="line">Ended Job = job_1502371586068_0004</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 4.11 sec   HDFS Read: 8068 HDFS Write: 101 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 4 seconds 110 msec</span><br><span class="line">OK</span><br><span class="line">5</span><br><span class="line">Time taken: 46.061 seconds, Fetched: 1 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="where">where</h2>
<p>可以用or和and连接多个表达式。</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>A=B</td>
<td>基本类型</td>
<td>A等于B返回true，否则返回false</td>
</tr>
<tr>
<td>A&lt;&gt;B，A!=B</td>
<td>基本类型</td>
<td>A或B为null，返回null; A和B都不空时，A不等于B返回true，否则返回false</td>
</tr>
<tr>
<td>A&lt;B</td>
<td>基本类型</td>
<td>A或B为null，返回null; A小于B返回true，否则返回false</td>
</tr>
<tr>
<td>A&lt;=B</td>
<td>基本类型</td>
<td>A或B为null，返回null; A小于等于B返回true，否则返回false</td>
</tr>
<tr>
<td>A&gt;B</td>
<td>基本类型</td>
<td>A或B为null，返回null; A大于B返回true，否则返回false</td>
</tr>
<tr>
<td>A&gt;=B</td>
<td>基本类型</td>
<td>A或B为null，返回null; A大于等于B返回true，否则返回false</td>
</tr>
<tr>
<td>A Between B And C</td>
<td>基本类型</td>
<td>筛选 A 的值处于 B 和 C 之间</td>
</tr>
<tr>
<td>A not between B and C</td>
<td>基本类型</td>
<td>筛选 A 的值不处于 B 和 C 之间</td>
</tr>
<tr>
<td>A is null</td>
<td>所有类型</td>
<td>如果A等于null，返回true,否则返回false。注意，不能使用A=null</td>
</tr>
<tr>
<td>A is not null</td>
<td>所有类型</td>
<td>筛选 A 值不是null的</td>
</tr>
<tr>
<td>A like B</td>
<td>string</td>
<td>B是一个SQL正则表达式，%表示一个或者多个字符，_表示一个字符</td>
</tr>
<tr>
<td>A not like B</td>
<td>string</td>
<td>与正则表达式B相反结果</td>
</tr>
<tr>
<td>A rlike B</td>
<td>string</td>
<td>正则匹配</td>
</tr>
</tbody>
</table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp</span></span><br><span class="line">    &gt; where did=30 and comm&lt;&gt;0.0;</span><br><span class="line">OK</span><br><span class="line">7499    ALLEN   SALESMAN    7698    1981-02-20  1600.0  300.0   30</span><br><span class="line">7521    WARD    SALESMAN    7698    1981-02-22  1250.0  500.0   30</span><br><span class="line">7654    MARTIN  SALESMAN    7698    1981-09-28  1250.0  1400.0  30</span><br><span class="line">Time taken: 0.667 seconds, Fetched: 3 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp</span></span><br><span class="line">    &gt; where hiredate between '1981-01-01' and '1981-12-30';</span><br><span class="line">OK</span><br><span class="line">7782    CLARK   MANAGER 7839    1981-06-09  2450.0  0.0 10</span><br><span class="line">7839    KING    PRESIDENT   0   1981-11-17  5000.0  0.0 10</span><br><span class="line">7566    JONES   MANAGER 7839    1981-04-02  2975.0  0.0 20</span><br><span class="line">7902    FORD    ANALYST 7566    1981-12-03  3000.0  0.0 20</span><br><span class="line">7499    ALLEN   SALESMAN    7698    1981-02-20  1600.0  300.0   30</span><br><span class="line">7521    WARD    SALESMAN    7698    1981-02-22  1250.0  500.0   30</span><br><span class="line">7654    MARTIN  SALESMAN    7698    1981-09-28  1250.0  1400.0  30</span><br><span class="line">7698    BLAKE   MANAGER 7839    1981-05-01  2850.0  0.0 30</span><br><span class="line">7844    TURNER  SALESMAN    7698    1981-09-08  1500.0  0.0 30</span><br><span class="line">7900    JAMES   CLERK   7698    1981-12-03  950.0   0.0 30</span><br><span class="line">Time taken: 0.311 seconds, Fetched: 10 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="limit">limit</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp <span class="built_in">limit</span> 5;</span></span><br><span class="line">OK</span><br><span class="line">7782    CLARK   MANAGER 7839    1981-06-09  2450.0  0.0 10</span><br><span class="line">7839    KING    PRESIDENT   0   1981-11-17  5000.0  0.0 10</span><br><span class="line">7934    MILLER  CLERK   7782    1982-01-23  1300.0  0.0 10</span><br><span class="line">7369    SMITH   CLERK   7902    1980-12-17  800.0   0.0 20</span><br><span class="line">7566    JONES   MANAGER 7839    1981-04-02  2975.0  0.0 20</span><br><span class="line">Time taken: 2.18 seconds, Fetched: 5 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp <span class="built_in">limit</span> 1,3;</span></span><br><span class="line">OK</span><br><span class="line">7839    KING    PRESIDENT   0   1981-11-17  5000.0  0.0 10</span><br><span class="line">7934    MILLER  CLERK   7782    1982-01-23  1300.0  0.0 10</span><br><span class="line">7369    SMITH   CLERK   7902    1980-12-17  800.0   0.0 20</span><br><span class="line">Time taken: 0.303 seconds, Fetched: 3 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="group-by">group by</h2>
<p>查询每个部门的人数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select count(*) from emp</span></span><br><span class="line">    &gt; group by did;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170814101839_fe4cccbd-62c4-48cb-986b-a70f93c19535</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502717288397_0003, Tracking URL = http://node1:8088/proxy/application_1502717288397_0003/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502717288397_0003</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2017-08-14 10:19:10,549 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-14 10:19:27,526 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.86 sec</span><br><span class="line">2017-08-14 10:19:42,984 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 6.84 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 6 seconds 840 msec</span><br><span class="line">Ended Job = job_1502717288397_0003</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 6.84 sec   HDFS Read: 9667 HDFS Write: 129 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 6 seconds 840 msec</span><br><span class="line">OK</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">6</span><br><span class="line">Time taken: 66.588 seconds, Fetched: 3 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>与Oracle数据库一样，如果使用group by子句，那么查询的字段如果没有出现在group by子句的后面，则必须使用聚合函数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select ename,avg(sal) from emp group by did;</span></span><br><span class="line">FAILED: SemanticException [Error 10025]: Line 1:7 Expression not in GROUP BY key 'ename'</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>如果想对分组结果进行过滤，可以使用having子句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select avg(sal) from emp </span></span><br><span class="line">    &gt; group by did</span><br><span class="line">    &gt; having avg(sal)&gt;2000;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170814103035_2106518a-aab4-4cdd-9b39-7b08fb1a44b6</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502717288397_0007, Tracking URL = http://node1:8088/proxy/application_1502717288397_0007/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502717288397_0007</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2017-08-14 10:31:08,601 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-14 10:31:25,888 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.88 sec</span><br><span class="line">2017-08-14 10:31:43,122 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 8.34 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 8 seconds 340 msec</span><br><span class="line">Ended Job = job_1502717288397_0007</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 8.34 sec   HDFS Read: 10807 HDFS Write: 149 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 8 seconds 340 msec</span><br><span class="line">OK</span><br><span class="line">2916.6666666666665</span><br><span class="line">2258.3333333333335</span><br><span class="line">Time taken: 70.202 seconds, Fetched: 2 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="order-by">order by</h2>
<p>Hive 中的 order by与SQL 中的order by语义相同，会对查询结果进行全局排序，但是Hive 语句最终要转换为 MapReduce 程序放到 Hadoop 分布式集群上去执行，多个Mapper 后汇集到一个 Reducer 上执行，如果结果数据量大，那就会造成 Reduce 执行相当漫长。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp</span></span><br><span class="line">    &gt; order by hiredate;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170814100601_114fbe7b-a71a-4575-8a85-582f83ead490</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks determined at compile time: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502717288397_0001, Tracking URL = http://node1:8088/proxy/application_1502717288397_0001/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502717288397_0001</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2017-08-14 10:06:36,164 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-14 10:06:57,150 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 4.01 sec</span><br><span class="line">2017-08-14 10:07:13,160 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 7.46 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 7 seconds 460 msec</span><br><span class="line">Ended Job = job_1502717288397_0001</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 7.46 sec   HDFS Read: 10295 HDFS Write: 821 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 7 seconds 460 msec</span><br><span class="line">OK</span><br><span class="line">7369    SMITH   CLERK   7902    1980-12-17  800.0   0.0 20</span><br><span class="line">7499    ALLEN   SALESMAN    7698    1981-02-20  1600.0  300.0   30</span><br><span class="line">7521    WARD    SALESMAN    7698    1981-02-22  1250.0  500.0   30</span><br><span class="line">7566    JONES   MANAGER 7839    1981-04-02  2975.0  0.0 20</span><br><span class="line">7698    BLAKE   MANAGER 7839    1981-05-01  2850.0  0.0 30</span><br><span class="line">7782    CLARK   MANAGER 7839    1981-06-09  2450.0  0.0 10</span><br><span class="line">7844    TURNER  SALESMAN    7698    1981-09-08  1500.0  0.0 30</span><br><span class="line">7654    MARTIN  SALESMAN    7698    1981-09-28  1250.0  1400.0  30</span><br><span class="line">7839    KING    PRESIDENT   0   1981-11-17  5000.0  0.0 10</span><br><span class="line">7900    JAMES   CLERK   7698    1981-12-03  950.0   0.0 30</span><br><span class="line">7902    FORD    ANALYST 7566    1981-12-03  3000.0  0.0 20</span><br><span class="line">7934    MILLER  CLERK   7782    1982-01-23  1300.0  0.0 10</span><br><span class="line">Time taken: 74.031 seconds, Fetched: 12 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from emp</span></span><br><span class="line">    &gt; where did=30</span><br><span class="line">    &gt; order by sal desc,eid asc;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170814101221_ac53277e-41d7-42a7-aa11-3ba2fe041795</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks determined at compile time: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502717288397_0002, Tracking URL = http://node1:8088/proxy/application_1502717288397_0002/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502717288397_0002</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2017-08-14 10:12:45,371 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-14 10:13:06,327 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 5.0 sec</span><br><span class="line">2017-08-14 10:13:23,493 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 9.38 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 9 seconds 380 msec</span><br><span class="line">Ended Job = job_1502717288397_0002</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 9.38 sec   HDFS Read: 10967 HDFS Write: 462 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 9 seconds 380 msec</span><br><span class="line">OK</span><br><span class="line">7698    BLAKE   MANAGER 7839    1981-05-01  2850.0  0.0 30</span><br><span class="line">7499    ALLEN   SALESMAN    7698    1981-02-20  1600.0  300.0   30</span><br><span class="line">7844    TURNER  SALESMAN    7698    1981-09-08  1500.0  0.0 30</span><br><span class="line">7521    WARD    SALESMAN    7698    1981-02-22  1250.0  500.0   30</span><br><span class="line">7654    MARTIN  SALESMAN    7698    1981-09-28  1250.0  1400.0  30</span><br><span class="line">7900    JAMES   CLERK   7698    1981-12-03  950.0   0.0 30</span><br><span class="line">Time taken: 65.629 seconds, Fetched: 6 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>请注意 ，<strong>Hive中尽量不要用Order By， 除非非常确定结果集很小</strong> 。但是排序的需求总是有的，Hive 中使用下面的几种排序来满足需求。</p>
<ul>
<li>sort by</li>
<li>distribute by</li>
<li>cluster by</li>
</ul>
<h2 id="sort-by">sort by</h2>
<p>sort by是在每个reduce中进行排序，是一个局部排序，可以保证每个reduce中是按照指定字段进行排好序的，但是全局上来说，相同字段可以被分配到不同的reduce上，虽然在各个reduce上是排好序的，但是全局上不一定是排好序的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select eid,ename,sal from emp sort by sal;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170820064647_81b26e52-d158-4861-89f0-677ec0db0b52</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Defaulting to jobconf value of: 2</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1503220733636_0009, Tracking URL = http://node1:8088/proxy/application_1503220733636_0009/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1503220733636_0009</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 2</span><br><span class="line">2017-08-20 06:47:02,958 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-20 06:47:12,622 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.47 sec</span><br><span class="line">2017-08-20 06:47:24,950 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 6.35 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 6 seconds 350 msec</span><br><span class="line">Ended Job = job_1503220733636_0009</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 2   Cumulative CPU: 6.35 sec   HDFS Read: 12635 HDFS Write: 559 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 6 seconds 350 msec</span><br><span class="line">OK</span><br><span class="line">8888    HADRON  NULL</span><br><span class="line">7369    SMITH   800.0</span><br><span class="line">7900    JAMES   950.0</span><br><span class="line">7521    WARD    1250.0</span><br><span class="line">7934    MILLER  1300.0</span><br><span class="line">7844    TURNER  1500.0</span><br><span class="line">7782    CLARK   2450.0</span><br><span class="line">7698    BLAKE   2850.0</span><br><span class="line">7566    JONES   2975.0</span><br><span class="line">7654    MARTIN  1250.0</span><br><span class="line">7499    ALLEN   1600.0</span><br><span class="line">7902    FORD    3000.0</span><br><span class="line">7839    KING    5000.0</span><br><span class="line">Time taken: 39.092 seconds, Fetched: 13 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="distribute-by">distribute by</h2>
<p>distribute by指定map输出结果怎么样划分后分配到各个Reduce上去，比如distribute by cid就可以保证cid字段相同的结果被分配到同一个reduce上去执行。然后再指定sort by cid在Reduce上进行按照cid进行排序。但是这种还是不能做到全局排序，只能保证排序字段值相同的放在一起，并且在reduce上局部是排好序的。</p>
<p>需要注意的是distribute by必须写在sort by前面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select eid,ename,sal,did from emp distribute by did sort by sal;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170820090113_637965de-369d-4a26-b233-0ee69513d6f3</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Defaulting to jobconf value of: 2</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1503220733636_0014, Tracking URL = http://node1:8088/proxy/application_1503220733636_0014/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1503220733636_0014</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 2</span><br><span class="line">2017-08-20 09:01:36,959 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-20 09:01:57,587 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.93 sec</span><br><span class="line">2017-08-20 09:02:14,251 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 9.04 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 9 seconds 40 msec</span><br><span class="line">Ended Job = job_1503220733636_0014</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 2   Cumulative CPU: 9.04 sec   HDFS Read: 13200 HDFS Write: 598 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 9 seconds 40 msec</span><br><span class="line">OK</span><br><span class="line">8888    HADRON  NULL    NULL</span><br><span class="line">7369    SMITH   800.0   20</span><br><span class="line">7900    JAMES   950.0   30</span><br><span class="line">7654    MARTIN  1250.0  30</span><br><span class="line">7521    WARD    1250.0  30</span><br><span class="line">7934    MILLER  1300.0  10</span><br><span class="line">7844    TURNER  1500.0  30</span><br><span class="line">7499    ALLEN   1600.0  30</span><br><span class="line">7782    CLARK   2450.0  10</span><br><span class="line">7698    BLAKE   2850.0  30</span><br><span class="line">7566    JONES   2975.0  20</span><br><span class="line">7902    FORD    3000.0  20</span><br><span class="line">7839    KING    5000.0  10</span><br><span class="line">Time taken: 61.594 seconds, Fetched: 13 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="cluster-by">cluster by</h2>
<p>如果 distribute by 和 sort by 的字段是同一个，可以简写为cluster by</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select eid,ename,sal,did from emp cluster by sal;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170820090813_f764950e-bcdd-4100-9554-2fc8a9c2bde1</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Defaulting to jobconf value of: 2</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1503220733636_0015, Tracking URL = http://node1:8088/proxy/application_1503220733636_0015/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1503220733636_0015</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 2</span><br><span class="line">2017-08-20 09:08:28,249 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-20 09:08:37,776 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.92 sec</span><br><span class="line">2017-08-20 09:08:49,509 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 7.1 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 7 seconds 100 msec</span><br><span class="line">Ended Job = job_1503220733636_0015</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 2   Cumulative CPU: 7.1 sec   HDFS Read: 13186 HDFS Write: 598 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 7 seconds 100 msec</span><br><span class="line">OK</span><br><span class="line">8888    HADRON  NULL    NULL</span><br><span class="line">7369    SMITH   800.0   20</span><br><span class="line">7900    JAMES   950.0   30</span><br><span class="line">7654    MARTIN  1250.0  30</span><br><span class="line">7521    WARD    1250.0  30</span><br><span class="line">7934    MILLER  1300.0  10</span><br><span class="line">7844    TURNER  1500.0  30</span><br><span class="line">7499    ALLEN   1600.0  30</span><br><span class="line">7782    CLARK   2450.0  10</span><br><span class="line">7698    BLAKE   2850.0  30</span><br><span class="line">7566    JONES   2975.0  20</span><br><span class="line">7902    FORD    3000.0  20</span><br><span class="line">7839    KING    5000.0  10</span><br><span class="line">Time taken: 37.126 seconds, Fetched: 13 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h1>联表查询</h1>
<p><strong>准备阶段</strong></p>
<p>部门数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node3 data]# vi dept</span><br><span class="line">[root@node3 data]# cat dept</span><br><span class="line">10,ACCOUNTING,NEW YORK</span><br><span class="line">20,RESEARCH,DALLAS</span><br><span class="line">30,SALES,CHICAGO</span><br><span class="line">40,OPERATIONS,BOSTON</span><br><span class="line">[root@node3 data]#</span><br></pre></td></tr></table></figure>
<p>创建部门表dept，并导入数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> create table <span class="keyword">if</span> not exists dept(</span></span><br><span class="line">    &gt; did    int,</span><br><span class="line">    &gt; dname string,</span><br><span class="line">    &gt; dloc string)</span><br><span class="line">    &gt; row format delimited fields terminated by ',';</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.185 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> load data <span class="built_in">local</span> inpath <span class="string">'/root/data/dept'</span> into table dept;</span></span><br><span class="line">Loading data to table default.dept</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.705 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from dept;</span></span><br><span class="line">OK</span><br><span class="line">10  ACCOUNTING  NEW YORK</span><br><span class="line">20  RESEARCH    DALLAS</span><br><span class="line">30  SALES   CHICAGO</span><br><span class="line">40  OPERATIONS  BOSTON</span><br><span class="line">Time taken: 0.155 seconds, Fetched: 4 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="内连接">内连接</h2>
<p>连接的两个表中，只有同时满足连接条件的记录才会放入结果表中。执行查询命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select eid,ename,dname from emp,dept where emp.did=dept.did;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select eid,ename,dname</span></span><br><span class="line">    &gt; from emp,dept</span><br><span class="line">    &gt; where emp.did=dept.did;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170815101902_18fb066b-11f2-438d-8a92-9d4490b80ec2</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-15 10:19:13 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-15 10:19:17 Dump the side-table for tag: 1 with group count: 4 into file: file:/tmp/root/6e48493b-cca6-4657-a459-7ff36c6137b1/hive_2017-08-15_10-19-02_412_1947825427115470836-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile11--.hashtable</span><br><span class="line">2017-08-15 10:19:17 Uploaded 1 File to: file:/tmp/root/6e48493b-cca6-4657-a459-7ff36c6137b1/hive_2017-08-15_10-19-02_412_1947825427115470836-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile11--.hashtable (373 bytes)</span><br><span class="line">2017-08-15 10:19:17 End of local task; Time Taken: 3.36 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502805552881_0002, Tracking URL = http://node1:8088/proxy/application_1502805552881_0002/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502805552881_0002</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-15 10:19:38,347 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-15 10:19:52,530 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 2.69 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 690 msec</span><br><span class="line">Ended Job = job_1502805552881_0002</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 2.69 sec   HDFS Read: 7746 HDFS Write: 459 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 690 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK   ACCOUNTING</span><br><span class="line">7839    KING    ACCOUNTING</span><br><span class="line">7934    MILLER  ACCOUNTING</span><br><span class="line">7369    SMITH   RESEARCH</span><br><span class="line">7566    JONES   RESEARCH</span><br><span class="line">7902    FORD    RESEARCH</span><br><span class="line">7499    ALLEN   SALES</span><br><span class="line">7521    WARD    SALES</span><br><span class="line">7654    MARTIN  SALES</span><br><span class="line">7698    BLAKE   SALES</span><br><span class="line">7844    TURNER  SALES</span><br><span class="line">7900    JAMES   SALES</span><br><span class="line">Time taken: 52.488 seconds, Fetched: 12 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>内连接另一种形式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.eid,e.ename,d.dname from emp e join dept d on e.did=d.did;</span><br></pre></td></tr></table></figure>
<p>其中，e和d分别是表emp和dept的别名。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename,d.dname</span></span><br><span class="line">    &gt; from emp e join dept d</span><br><span class="line">    &gt; on e.did=d.did;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170815102454_0ca5cc0f-1802-4b4f-8156-d055482971b7</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-15 10:25:06 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-15 10:25:10 Dump the side-table for tag: 1 with group count: 4 into file: file:/tmp/root/6e48493b-cca6-4657-a459-7ff36c6137b1/hive_2017-08-15_10-24-54_978_8533839352082414207-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile21--.hashtable</span><br><span class="line">2017-08-15 10:25:10 Uploaded 1 File to: file:/tmp/root/6e48493b-cca6-4657-a459-7ff36c6137b1/hive_2017-08-15_10-24-54_978_8533839352082414207-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile21--.hashtable (373 bytes)</span><br><span class="line">2017-08-15 10:25:10 End of local task; Time Taken: 3.864 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502805552881_0003, Tracking URL = http://node1:8088/proxy/application_1502805552881_0003/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502805552881_0003</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-15 10:25:27,803 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-15 10:25:38,323 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 2.24 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 240 msec</span><br><span class="line">Ended Job = job_1502805552881_0003</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 2.24 sec   HDFS Read: 7746 HDFS Write: 459 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 240 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK   ACCOUNTING</span><br><span class="line">7839    KING    ACCOUNTING</span><br><span class="line">7934    MILLER  ACCOUNTING</span><br><span class="line">7369    SMITH   RESEARCH</span><br><span class="line">7566    JONES   RESEARCH</span><br><span class="line">7902    FORD    RESEARCH</span><br><span class="line">7499    ALLEN   SALES</span><br><span class="line">7521    WARD    SALES</span><br><span class="line">7654    MARTIN  SALES</span><br><span class="line">7698    BLAKE   SALES</span><br><span class="line">7844    TURNER  SALES</span><br><span class="line">7900    JAMES   SALES</span><br><span class="line">Time taken: 44.558 seconds, Fetched: 12 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h2 id="外连接">外连接</h2>
<p>内连接只显示了俩张表都存在的数据，而外连接则是显示出所有的数据 。外连接又分为左外连接、右外连接以及全外连接，可以简称左连接、右连接和全连接。其中左连接是左边的表输出完整数据。右连接是右边的表输出完整数据，全连接就是两张表的所有行全部输出。</p>
<p><strong>补充数据</strong></p>
<p>为了测试外连接，需要在雇员表中添加一个没有部门的新员工信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert into emp(eid,ename,hiredate) values(8888,<span class="string">'HADRON'</span>,<span class="string">'2016-08-31'</span>); </span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816091805_3f28cfe1-278a-486e-9ed4-34ee791f5322</span><br><span class="line">Total jobs = 3</span><br><span class="line">Launching Job 1 out of 3</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502887685471_0005, Tracking URL = http://node1:8088/proxy/application_1502887685471_0005/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0005</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-16 09:18:20,468 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:18:32,863 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.48 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 480 msec</span><br><span class="line">Ended Job = job_1502887685471_0005</span><br><span class="line">Stage-4 is selected by condition resolver.</span><br><span class="line">Stage-3 is filtered out by condition resolver.</span><br><span class="line">Stage-5 is filtered out by condition resolver.</span><br><span class="line">Moving data to directory hdfs://cetc/user/hive/warehouse/emp/.hive-staging_hive_2017-08-16_09-18-05_560_4497324549163312419-1/-ext-10000</span><br><span class="line">Loading data to table default.emp</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1   Cumulative CPU: 2.48 sec   HDFS Read: 4861 HDFS Write: 105 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 480 msec</span><br><span class="line">OK</span><br><span class="line">Time taken: 30.102 seconds</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h3 id="左连接">左连接</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename,d.dname from emp e left join dept d on e.did=d.did;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816091950_1483c055-0461-4293-9387-3221eb15b448</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-16 09:20:01 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-16 09:20:04 Dump the side-table for tag: 1 with group count: 4 into file: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-19-50_831_2141891134326428737-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile21--.hashtable</span><br><span class="line">2017-08-16 09:20:04 Uploaded 1 File to: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-19-50_831_2141891134326428737-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile21--.hashtable (373 bytes)</span><br><span class="line">2017-08-16 09:20:04 End of local task; Time Taken: 2.606 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502887685471_0006, Tracking URL = http://node1:8088/proxy/application_1502887685471_0006/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0006</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-16 09:20:20,596 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:20:30,466 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 1.82 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 1 seconds 820 msec</span><br><span class="line">Ended Job = job_1502887685471_0006</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 1.82 sec   HDFS Read: 7158 HDFS Write: 486 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 1 seconds 820 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK   ACCOUNTING</span><br><span class="line">7839    KING    ACCOUNTING</span><br><span class="line">7934    MILLER  ACCOUNTING</span><br><span class="line">7369    SMITH   RESEARCH</span><br><span class="line">7566    JONES   RESEARCH</span><br><span class="line">7902    FORD    RESEARCH</span><br><span class="line">7499    ALLEN   SALES</span><br><span class="line">7521    WARD    SALES</span><br><span class="line">7654    MARTIN  SALES</span><br><span class="line">7698    BLAKE   SALES</span><br><span class="line">7844    TURNER  SALES</span><br><span class="line">7900    JAMES   SALES</span><br><span class="line">8888    HADRON  NULL</span><br><span class="line">Time taken: 41.877 seconds, Fetched: 13 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h3 id="右连接">右连接</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename,d.dname from emp e right join dept d on e.did=d.did;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816092117_f97eea90-4039-45f9-8097-900c457f50f3</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-16 09:21:28 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-16 09:21:31 Dump the side-table for tag: 0 with group count: 4 into file: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-21-17_901_4210650042244478897-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile30--.hashtable</span><br><span class="line">2017-08-16 09:21:31 Uploaded 1 File to: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-21-17_901_4210650042244478897-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile30--.hashtable (498 bytes)</span><br><span class="line">2017-08-16 09:21:31 End of local task; Time Taken: 2.599 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502887685471_0007, Tracking URL = http://node1:8088/proxy/application_1502887685471_0007/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0007</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-16 09:21:48,072 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:21:58,404 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 1.95 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 1 seconds 950 msec</span><br><span class="line">Ended Job = job_1502887685471_0007</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 1.95 sec   HDFS Read: 6169 HDFS Write: 488 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 1 seconds 950 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK   ACCOUNTING</span><br><span class="line">7839    KING    ACCOUNTING</span><br><span class="line">7934    MILLER  ACCOUNTING</span><br><span class="line">7369    SMITH   RESEARCH</span><br><span class="line">7566    JONES   RESEARCH</span><br><span class="line">7902    FORD    RESEARCH</span><br><span class="line">7499    ALLEN   SALES</span><br><span class="line">7521    WARD    SALES</span><br><span class="line">7654    MARTIN  SALES</span><br><span class="line">7698    BLAKE   SALES</span><br><span class="line">7844    TURNER  SALES</span><br><span class="line">7900    JAMES   SALES</span><br><span class="line">NULL    NULL    OPERATIONS</span><br><span class="line">Time taken: 42.768 seconds, Fetched: 13 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h3 id="全连接">全连接</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename,d.dname from emp e full join dept d on e.did=d.did;</span></span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816092230_3b3f51e8-2753-41a2-9f41-af98770847fa</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1502887685471_0008, Tracking URL = http://node1:8088/proxy/application_1502887685471_0008/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0008</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 2; number of reducers: 1</span><br><span class="line">2017-08-16 09:22:45,280 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:23:06,469 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 6.28 sec</span><br><span class="line">2017-08-16 09:23:16,137 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 8.52 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 8 seconds 520 msec</span><br><span class="line">Ended Job = job_1502887685471_0008</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 2  Reduce: 1   Cumulative CPU: 8.52 sec   HDFS Read: 16627 HDFS Write: 515 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 8 seconds 520 msec</span><br><span class="line">OK</span><br><span class="line">8888    HADRON  NULL</span><br><span class="line">7782    CLARK   ACCOUNTING</span><br><span class="line">7934    MILLER  ACCOUNTING</span><br><span class="line">7839    KING    ACCOUNTING</span><br><span class="line">7902    FORD    RESEARCH</span><br><span class="line">7566    JONES   RESEARCH</span><br><span class="line">7369    SMITH   RESEARCH</span><br><span class="line">7654    MARTIN  SALES</span><br><span class="line">7521    WARD    SALES</span><br><span class="line">7900    JAMES   SALES</span><br><span class="line">7499    ALLEN   SALES</span><br><span class="line">7844    TURNER  SALES</span><br><span class="line">7698    BLAKE   SALES</span><br><span class="line">NULL    NULL    OPERATIONS</span><br><span class="line">Time taken: 47.921 seconds, Fetched: 14 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h3 id="左半连接">左半连接</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename from emp e </span></span><br><span class="line">    &gt; left semi join dept d</span><br><span class="line">    &gt; on e.did=d.did;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816093310_97649892-9cb8-4b26-954a-1a301976184d</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-16 09:33:22 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-16 09:33:25 Dump the side-table for tag: 1 with group count: 4 into file: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-33-10_356_3322488615725018370-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile51--.hashtable</span><br><span class="line">2017-08-16 09:33:25 Uploaded 1 File to: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-33-10_356_3322488615725018370-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile51--.hashtable (332 bytes)</span><br><span class="line">2017-08-16 09:33:25 End of local task; Time Taken: 2.642 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502887685471_0010, Tracking URL = http://node1:8088/proxy/application_1502887685471_0010/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0010</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-16 09:33:43,441 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:33:55,350 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 2.93 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 930 msec</span><br><span class="line">Ended Job = job_1502887685471_0010</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 2.93 sec   HDFS Read: 7152 HDFS Write: 363 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 930 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK</span><br><span class="line">7839    KING</span><br><span class="line">7934    MILLER</span><br><span class="line">7369    SMITH</span><br><span class="line">7566    JONES</span><br><span class="line">7902    FORD</span><br><span class="line">7499    ALLEN</span><br><span class="line">7521    WARD</span><br><span class="line">7654    MARTIN</span><br><span class="line">7698    BLAKE</span><br><span class="line">7844    TURNER</span><br><span class="line">7900    JAMES</span><br><span class="line">Time taken: 46.179 seconds, Fetched: 12 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p><strong>左半连接和内连接的结果一样，只不过使用IN查询。相当于以下语句：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select e.eid,e.ename from emp e </span></span><br><span class="line">    &gt; where e.did in(select d.did from dept d);</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">Query ID = root_20170816092716_b479bf9e-fd03-48a1-be72-fb64d90f2efc</span><br><span class="line">Total jobs = 1</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hive-2.1.1/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/opt/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2017-08-16 09:27:27 Starting to launch local task to process map join;  maximum memory = 518979584</span><br><span class="line">2017-08-16 09:27:30 Dump the side-table for tag: 1 with group count: 4 into file: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-27-16_222_8300160340562225012-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile41--.hashtable</span><br><span class="line">2017-08-16 09:27:30 Uploaded 1 File to: file:/tmp/root/50703eac-08fc-4214-9bd0-488ad09f51e2/hive_2017-08-16_09-27-16_222_8300160340562225012-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile41--.hashtable (332 bytes)</span><br><span class="line">2017-08-16 09:27:30 End of local task; Time Taken: 2.987 sec.</span><br><span class="line">Execution completed successfully</span><br><span class="line">MapredLocal task succeeded</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks is set to 0 since there's no reduce operator</span><br><span class="line">Starting Job = job_1502887685471_0009, Tracking URL = http://node1:8088/proxy/application_1502887685471_0009/</span><br><span class="line">Kill Command = /opt/hadoop-2.7.3/bin/hadoop job  -kill job_1502887685471_0009</span><br><span class="line">Hadoop job information for Stage-3: number of mappers: 1; number of reducers: 0</span><br><span class="line">2017-08-16 09:27:46,861 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">2017-08-16 09:27:59,352 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 2.91 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 910 msec</span><br><span class="line">Ended Job = job_1502887685471_0009</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-3: Map: 1   Cumulative CPU: 2.91 sec   HDFS Read: 7152 HDFS Write: 363 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 910 msec</span><br><span class="line">OK</span><br><span class="line">7782    CLARK</span><br><span class="line">7839    KING</span><br><span class="line">7934    MILLER</span><br><span class="line">7369    SMITH</span><br><span class="line">7566    JONES</span><br><span class="line">7902    FORD</span><br><span class="line">7499    ALLEN</span><br><span class="line">7521    WARD</span><br><span class="line">7654    MARTIN</span><br><span class="line">7698    BLAKE</span><br><span class="line">7844    TURNER</span><br><span class="line">7900    JAMES</span><br><span class="line">Time taken: 44.323 seconds, Fetched: 12 row(s)</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p><strong>注意，左半连接通常比内连接要高效，因为对于左表的一条指定的记录，在右表一旦找到匹配的记录，Hive就会停止扫描。</strong></p>
<h1>不支持删除修改记录</h1>
<p>不支持删除修改记录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> delete from users <span class="built_in">where</span> id=1;</span></span><br><span class="line">FAILED: SemanticException [Error 10294]: Attempt to do update or delete using transaction manager that does not support these operations.</span><br><span class="line"></span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"> update users <span class="built_in">set</span> name=<span class="string">'xx'</span> <span class="built_in">where</span> id=1;</span></span><br><span class="line">FAILED: SemanticException [Error 10294]: Attempt to do update or delete using transaction manager that does not support these operations.</span><br><span class="line"><span class="meta">hive&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>

      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/Hive%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">HIVE学习笔记</a></li>
            <li>04-HQL-数据操作</li>
          
  </ul>

    
    
    
  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">插入数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#insert-into"><span class="nav-text">insert into</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#insert-overwrite"><span class="nav-text">insert overwrite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#insert-into和insert-overowrite的区别"><span class="nav-text">insert into和insert overowrite的区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">简单查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#where"><span class="nav-text">where</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#limit"><span class="nav-text">limit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#group-by"><span class="nav-text">group by</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#order-by"><span class="nav-text">order by</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sort-by"><span class="nav-text">sort by</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#distribute-by"><span class="nav-text">distribute by</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cluster-by"><span class="nav-text">cluster by</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">联表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#内连接"><span class="nav-text">内连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#外连接"><span class="nav-text">外连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#左连接"><span class="nav-text">左连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#右连接"><span class="nav-text">右连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全连接"><span class="nav-text">全连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#左半连接"><span class="nav-text">左半连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">不支持删除修改记录</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="jiateng.jiang"
    src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">jiateng.jiang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiateng.jiang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  






  <script src="/js/local-search.js"></script>








<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '100%'
      });
    });
  }, window.PDFObject);
}
</script>





  

  

  

</body>
</html>
