<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.json',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Spring的JDBC框架承担了资源管理和异常处理的工作，从而简化了JDBC代码，让我们只需编写从数据库读写数据的必需代码。正如前面小节所介绍过的，Spring将数据访问的样板代码抽象到模板类之中。Spring为JDBC提供了三个模板类供选择： JdbcTemplate：最基本的Spring JDBC模板，这个模板支持简单的JDBC数据库访问功能以及基于索引参数的查询； NamedParamete">
<meta property="og:type" content="website">
<meta property="og:title" content="JJT-个人Wiki">
<meta property="og:url" content="https:&#x2F;&#x2F;hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com&#x2F;quotes&#x2F;Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0&#x2F;43-JDBC%E6%A8%A1%E6%9D%BF%E7%B1%BB.html">
<meta property="og:site_name" content="JJT-个人Wiki">
<meta property="og:description" content="Spring的JDBC框架承担了资源管理和异常处理的工作，从而简化了JDBC代码，让我们只需编写从数据库读写数据的必需代码。正如前面小节所介绍过的，Spring将数据访问的样板代码抽象到模板类之中。Spring为JDBC提供了三个模板类供选择： JdbcTemplate：最基本的Spring JDBC模板，这个模板支持简单的JDBC数据库访问功能以及基于索引参数的查询； NamedParamete">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812482_20200322013453422_26391.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812482_20200322013452807_31834.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812481_20200322013452497_3426.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812481_20200322013452082_31733.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812479_20200322013451871_5618.png">
<meta property="og:updated_time" content="2020-12-15T11:07:33.040Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584812482_20200322013453422_26391.png">

<link rel="canonical" href="https://hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com/quotes/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/43-JDBC%E6%A8%A1%E6%9D%BF%E7%B1%BB">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>

  <title> | JJT-个人Wiki
  </title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JJT-个人Wiki</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">you see see you one day day</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content">
            

  <div class="posts-expand">
    
    
    
    <div class="post-block" lang="zh-CN">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">
</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">SPRING学习笔记</a></li>
            <li>43-JDBC模板类</li>
          
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
          <p>Spring的JDBC框架承担了资源管理和异常处理的工作，从而简化了JDBC代码，让我们只需编写从数据库读写数据的必需代码。</p><p>正如前面小节所介绍过的，Spring将数据访问的样板代码抽象到模板类之中。Spring为JDBC提供了三个模板类供选择：</p><ul>
<li>JdbcTemplate：最基本的Spring JDBC模板，这个模板支持简单的JDBC数据库访问功能以及基于索引参数的查询；</li>
<li>NamedParameterJdbcTemplate：使用该模板类执行查询时可以将值以命名参数的形式绑定到SQL中，而不是使用简单的索引参数；</li>
<li>SimpleJdbcTemplate：该模板类利用Java 5的一些特性如自动装箱、泛型以及可变参数列表来简化JDBC模板的使用。</li>
</ul><a id="more"></a>


<p>以前，在选择哪一个JDBC模板的时候，我们需要仔细权衡。但是从Spring 3.1开始，做这个决定变得容易多了。SimpleJdbcTemplate已经被废弃了，其Java 5的特性被转移到了JdbcTemplate中，并且只有在你需要使用命名参数的时候，才需要使用NamedParameterJdbcTemplate。这样的话，对于大多数的JDBC任务来说，JdbcTemplate就是最好的可选方案，这也是本小节中所关注的方案。</p>
<h1>JdbcTemplate类</h1>
<p>Spring JDBC抽象框架core包提供了JDBC模板类，其中JdbcTemplate是core包的核心类，所以其他模板类都是基于它封装完成的。</p>
<p>JdbcTemplate类对可变部分采用回调接口方式实现，如ConnectionCallback通过回调接口返回给用户一个连接，从而可以使用该连接做任何事情、StatementCallback通过回调接口返回给用户一个Statement，从而可以使用该Statement做任何事情等等，还有其他一些回调接口如图所示。</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584812482_20200322013453422_26391.png" alt></p>
<h2 id="主要JDBC操作方法">主要JDBC操作方法</h2>
<p>JdbcTemplate主要提供以下五类JDBC操作方法</p>
<ul>
<li>execute方法：可以用于执行任何SQL语句，一般用于执行DDL语句（数据库模式定义语言，如CREATE DATABASE，CREATE TABLE，ALTER TABLE ，DROP TABLE，CREATE VIEW，ALTER VIEW ，DROP VIEW 等）；</li>
<li>update方法及batchUpdate方法：update方法用于执行新增、修改、删除等语句；batchUpdate方法用于执行批处理相关语句；</li>
<li>query方法及queryForXXX方法：用于执行查询相关语句；</li>
<li>call方法：用于执行存储过程、函数相关语句。</li>
</ul>
<p>调用以上方法的同时可以传入相关回调接口实现对象，用于自定义方法执行过程中的相关参数设置、JDBC操作或者结果集处理等。</p>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CURDTest</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">       <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">       <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCURD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       insert();</span><br><span class="line">       delete();</span><br><span class="line">       update();</span><br><span class="line">       select();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate.update(<span class="string">"insert into test(name) values('name1')"</span>);</span><br><span class="line">       jdbcTemplate.update(<span class="string">"insert into test(name) values('name2')"</span>);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate.update(<span class="string">"delete from test where name=?"</span>, <span class="keyword">new</span> Object[]&#123;<span class="string">"name2"</span>&#125;);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate.update(<span class="string">"update test set name='name3' where name=?"</span>, <span class="keyword">new</span> Object[]&#123;<span class="string">"name1"</span>&#125;);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test where name='name3'"</span>));</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate.query(<span class="string">"select * from test"</span>, <span class="keyword">new</span> RowCallbackHandler()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">               System.out.print(<span class="string">"====id:"</span> + rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">               System.out.println(<span class="string">",name:"</span> + rs.getString(<span class="string">"name"</span>));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简易的queryForXXX方法">简易的queryForXXX方法</h2>
<p>JdbcTemplate提供更简单的queryForXXX方法，来简化开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 处理结果集的更简便的方法：queryForXXX</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testResultSet4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   jdbcTemplate.execute(<span class="string">"alter table test add column last_name varchar(100)"</span>);</span><br><span class="line">   jdbcTemplate.update(<span class="string">"insert into test(name) values('name5')"</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">int</span> count = jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, count);</span><br><span class="line">   Map result1 = jdbcTemplate.queryForMap(<span class="string">"select * from test where name='name5'"</span>);</span><br><span class="line">   Assert.assertEquals(<span class="string">"name5"</span>, result1.get(<span class="string">"name"</span>));</span><br><span class="line">   count = jdbcTemplate.queryForObject(<span class="string">"select count(*) from test"</span>, Integer.class);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, count);</span><br><span class="line">   List&lt;Map&lt;String, Object&gt;&gt; result2 = jdbcTemplate.queryForList(<span class="string">"select * from test"</span>);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result2.size());</span><br><span class="line">   List&lt;String&gt; result3 = jdbcTemplate.queryForList(<span class="string">"select name from test where name=?"</span>, <span class="keyword">new</span> Object[]&#123;<span class="string">"name5"</span>&#125;, String.class);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result3.size());</span><br><span class="line">   SqlRowSet rs = jdbcTemplate.queryForRowSet(<span class="string">"select * from test"</span>);</span><br><span class="line">   List result4 = <span class="keyword">new</span> ArrayList();</span><br><span class="line">   <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">       result4.add(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">   &#125;</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result4.size());</span><br><span class="line">   </span><br><span class="line">   jdbcTemplate.update(<span class="string">"delete from test where name='name5'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Jdbc模板回调类</h1>
<h2 id="Statement对象回调">Statement对象回调</h2>
<p>用于根据JdbcTemplate提供的连接创建相关的Statement对象：</p>
<ul>
<li><strong>PreparedStatementCreator</strong>：通过回调传入JdbcTemplate提供的Connection对象，由用户使用该Conncetion创建相关的PreparedStatement；</li>
<li><strong>CallableStatementCreator</strong>：通过回调传入JdbcTemplate提供的Connection对象，由用户使用该Conncetion创建相关的CallableStatement。</li>
</ul>
<p>用于给JdbcTemplate提供的Statement对象相应参数设值：</p>
<ul>
<li><strong>PreparedStatementSetter</strong>：通过回调传入JdbcTemplate提供的PreparedStatement对象，由用户对该对象相应参数设值；</li>
<li><strong>BatchPreparedStatementSetter</strong>：类似于PreparedStatementSetter，但用于批处理，需要指定批处理大小。</li>
</ul>
<p>提供给用户一个扩展点，用户可以在指定类型的扩展点执行任何需要的操作。</p>
<ul>
<li><strong>ConnectionCallback</strong>：通过回调传入JdbcTemplate提供的Connection，用户可在该Connection执行任何作；</li>
<li><strong>StatementCallback</strong>：通过回调传入JdbcTemplate提供的Statement，用户可以在该Statement执行任何操作；</li>
<li><strong>PreparedStatementCallback</strong>：通过回调传入JdbcTemplate提供的PreparedStatement，用户可在该PreparedStatement执行任何操作；</li>
<li><strong>CallableStatementCallback</strong>：通过回调传入JdbcTemplate提供的CallableStatement，用户可在该CallableStatement执行任何操作。</li>
</ul>
<p><strong>示例一：PreparedStatement创建回调</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPreparedStatement1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> count = jdbcTemplate.execute(<span class="keyword">new</span> PreparedStatementCreator() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span><span class="params">(Connection conn)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> conn.prepareStatement(<span class="string">"select count(*) from test"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;, <span class="keyword">new</span> PreparedStatementCallback&lt;Integer&gt;() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Integer <span class="title">doInPreparedStatement</span><span class="params">(PreparedStatement pstmt)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> SQLException, DataAccessException </span>&#123;</span><br><span class="line">           pstmt.execute();</span><br><span class="line">           ResultSet rs = pstmt.getResultSet();</span><br><span class="line">           rs.next();</span><br><span class="line">           <span class="keyword">return</span> rs.getInt(<span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   Assert.assertEquals(<span class="number">0</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>示例二：CallableStatement创建回调</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 调用存储过程：</span></span><br><span class="line"><span class="comment">* &#123;call PROCEDURE_TEST(?, ?)&#125;：定义存储过程sql；</span></span><br><span class="line"><span class="comment">* params：定义存储过程参数；SqlInOutParameter描述INOUT类型参数、SqlOutParameter描述OUT类型参数；</span></span><br><span class="line"><span class="comment">* CallableStatementCreator：用于创建CallableStatement，并设值及注册OUT参数类型；</span></span><br><span class="line"><span class="comment">* outValues：通过SqlInOutParameter及SqlOutParameter参数定义的name来获取存储过程结果。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallableStatementCreator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> String callProcedureSql = <span class="string">"&#123;call PROCEDURE_TEST(?, ?)&#125;"</span>;</span><br><span class="line">   List&lt;SqlParameter&gt; params = <span class="keyword">new</span> ArrayList&lt;SqlParameter&gt;();</span><br><span class="line">   params.add(<span class="keyword">new</span> SqlInOutParameter(<span class="string">"inOutName"</span>, Types.VARCHAR));</span><br><span class="line">   params.add(<span class="keyword">new</span> SqlOutParameter(<span class="string">"outId"</span>, Types.INTEGER));</span><br><span class="line">   </span><br><span class="line">   Map&lt;String, Object&gt; outValues = jdbcTemplate.call(<span class="keyword">new</span> CallableStatementCreator() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> CallableStatement <span class="title">createCallableStatement</span><span class="params">(Connection conn)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           CallableStatement cstmt = conn.prepareCall(callProcedureSql);</span><br><span class="line">           cstmt.registerOutParameter(<span class="number">1</span>, Types.VARCHAR);</span><br><span class="line">           cstmt.registerOutParameter(<span class="number">2</span>, Types.INTEGER);</span><br><span class="line">           cstmt.setString(<span class="number">1</span>, <span class="string">"test"</span>);</span><br><span class="line">           <span class="keyword">return</span> cstmt;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;, params);</span><br><span class="line">   Assert.assertEquals(<span class="string">"Hello,test"</span>, outValues.get(<span class="string">"inOutName"</span>));</span><br><span class="line">   Assert.assertEquals(<span class="number">0</span>, outValues.get(<span class="string">"outId"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>示例三：PreparedStatementSetter回调使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPreparedStatement2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   String insertSql = <span class="string">"insert into test(name) values (?)"</span>;</span><br><span class="line">   <span class="keyword">int</span> count = jdbcTemplate.update(insertSql, <span class="keyword">new</span> PreparedStatementSetter() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(PreparedStatement pstmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           pstmt.setObject(<span class="number">1</span>, <span class="string">"name4"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, count);</span><br><span class="line">   </span><br><span class="line">   String deleteSql = <span class="string">"delete from test where name=?"</span>;</span><br><span class="line">   count = jdbcTemplate.update(deleteSql, <span class="keyword">new</span> Object[] &#123;<span class="string">"name4"</span>&#125;);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>示例四：PreparedStatementCallback回调使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPreparedStatement1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> count = jdbcTemplate.execute(<span class="keyword">new</span> PreparedStatementCreator() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span><span class="params">(Connection conn)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> conn.prepareStatement(<span class="string">"select count(*) from test"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;, <span class="keyword">new</span> PreparedStatementCallback&lt;Integer&gt;() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Integer <span class="title">doInPreparedStatement</span><span class="params">(PreparedStatement pstmt)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> SQLException, DataAccessException </span>&#123;</span><br><span class="line">           pstmt.execute();</span><br><span class="line">           ResultSet rs = pstmt.getResultSet();</span><br><span class="line">           rs.next();</span><br><span class="line">           <span class="keyword">return</span> rs.getInt(<span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   Assert.assertEquals(<span class="number">0</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结果集处理回调">结果集处理回调</h2>
<p>通过回调处理ResultSet或将ResultSet转换为需要的形式。</p>
<ul>
<li><strong>RowMapper</strong>：用于将结果集每行数据转换为需要的类型，用户需实现方法mapRow(ResultSet rs, int rowNum)来完成将每行数据转换为相应的类型；</li>
<li><strong>RowCallbackHandler</strong>：用于处理ResultSet的每一行结果，用户需实现方法processRow(ResultSet rs)来完成处理。注意，该回调方法中无需执行rs.next()（该操作由JdbcTemplate来执行），用户只需处理每一行数据；</li>
<li><strong>ResultSetExtractor</strong>：用于结果集数据提取，用户需实现方法extractData(ResultSet rs)来处理结果集，用户必须处理整个结果集。</li>
</ul>
<p>示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* RowMapper接口提供mapRow(ResultSet rs, int rowNum)方法将结果集的每一行转换为一个Map，</span></span><br><span class="line"><span class="comment">* 当然可以转换为其他类，如表的对象画形式。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testResultSet1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   jdbcTemplate.update(<span class="string">"insert into test(name) values('name5')"</span>);</span><br><span class="line">   String listSql = <span class="string">"select * from test"</span>;</span><br><span class="line">   List result = jdbcTemplate.query(listSql, <span class="keyword">new</span> RowMapper&lt;Map&gt;() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Map <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           Map row = <span class="keyword">new</span> HashMap();</span><br><span class="line">           row.put(rs.getInt(<span class="string">"id"</span>), rs.getString(<span class="string">"name"</span>));</span><br><span class="line">           <span class="keyword">return</span> row;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result.size());</span><br><span class="line">   jdbcTemplate.update(<span class="string">"delete from test where name='name5'"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* RowCallbackHandler接口也提供方法processRow(ResultSet rs)，能将结果集的行转换为需要的形式。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testResultSet2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   jdbcTemplate.update(<span class="string">"insert into test(name) values('name5')"</span>);</span><br><span class="line">   String listSql = <span class="string">"select * from test"</span>;</span><br><span class="line">   <span class="keyword">final</span> List result = <span class="keyword">new</span> ArrayList();</span><br><span class="line">   jdbcTemplate.query(listSql, <span class="keyword">new</span> RowCallbackHandler() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           Map row = <span class="keyword">new</span> HashMap();</span><br><span class="line">           row.put(rs.getInt(<span class="string">"id"</span>), rs.getString(<span class="string">"name"</span>));</span><br><span class="line">           result.add(row);</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">   &#125;);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result.size());</span><br><span class="line">   jdbcTemplate.update(<span class="string">"delete from test where name='name5'"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ResultSetExtractor使用回调方法extractData(ResultSet rs)提供给用户整个结果集，让用户决定如何处理该结果集。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testResultSet3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   jdbcTemplate.update(<span class="string">"insert into test(name) values('name5')"</span>);</span><br><span class="line">   String listSql = <span class="string">"select * from test"</span>;</span><br><span class="line">   List result = jdbcTemplate.query(listSql, <span class="keyword">new</span> ResultSetExtractor&lt;List&gt;() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> List <span class="title">extractData</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException, DataAccessException </span>&#123;</span><br><span class="line">           List result = <span class="keyword">new</span> ArrayList();</span><br><span class="line">           <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">               Map row = <span class="keyword">new</span> HashMap();</span><br><span class="line">               row.put(rs.getInt(<span class="string">"id"</span>), rs.getString(<span class="string">"name"</span>));</span><br><span class="line">               result.add(row);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> result;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result.size());</span><br><span class="line">   jdbcTemplate.update(<span class="string">"delete from test where name='name5'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>NamedParameterJdbcTemplate类</h1>
<p>NamedParameterJdbcTemplate类是基于JdbcTemplate类，并对它进行了封装从而支持命名参数特性。</p>
<p>NamedParameterJdbcTemplate主要提供以下三类方法：execute方法、query及queryForXXX方法、update及batchUpdate方法。</p>
<p>所谓命名参数指的是：对SQL中传入的参数进行命名标识，而后在执行方法中通过参数包装类传入相应的命名参数。</p>
<p>SQL语句中使用 <code>:parameterName</code> 定义一个命名参数。</p>
<p>NamedParameterJdbcTemplate类为命名参数设值有两种方式：java.util.Map和SqlParameterSource：</p>
<p>1）java.util.Map：使用Map键数据来对于命名参数，而Map值数据用于设值；</p>
<p>2）SqlParameterSource：可以使用SqlParameterSource实现作为来实现为命名参数设值，默认有MapSqlParameterSource和BeanPropertySqlParameterSource实现；</p>
<ul>
<li>MapSqlParameterSource实现非常简单，只是封装了java.util.Map；</li>
<li>而BeanPropertySqlParameterSource封装了一个JavaBean对象，通过JavaBean对象属性来决定命名参数的值。</li>
</ul>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNamedParameterJdbcTemplate1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   NamedParameterJdbcTemplate namedParameterJdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   <span class="comment">//namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);</span></span><br><span class="line">   namedParameterJdbcTemplate = <span class="keyword">new</span> NamedParameterJdbcTemplate(jdbcTemplate);</span><br><span class="line">   String insertSql = <span class="string">"insert into test(name) values(:name)"</span>;</span><br><span class="line">   String selectSql = <span class="string">"select * from test where name=:name"</span>;</span><br><span class="line">   String deleteSql = <span class="string">"delete from test where name=:name"</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//通过Map传入命名参数</span></span><br><span class="line">   Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">   paramMap.put(<span class="string">"name"</span>, <span class="string">"name5"</span>);</span><br><span class="line">   namedParameterJdbcTemplate.update(insertSql, paramMap);</span><br><span class="line">   <span class="keyword">final</span> List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">   namedParameterJdbcTemplate.query(selectSql, paramMap, <span class="keyword">new</span> RowCallbackHandler() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           result.add(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result.size());</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//通过MapSqlParameterSource传入命名参数</span></span><br><span class="line">   SqlParameterSource paramSource = <span class="keyword">new</span> MapSqlParameterSource(paramMap);</span><br><span class="line">   namedParameterJdbcTemplate.update(deleteSql, paramSource);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * BeanPropertySqlParameterSource类为SqlParameterSource的另一个实现，它封装了一个JavaBean</span></span><br><span class="line"><span class="comment">    * 对象，通过JavaBean对象属性来决定命名参数的值。</span></span><br><span class="line"><span class="comment">    * BeanPropertySqlParameterSource使用能减少很多工作量，但命名参数必须和JavaBean属性名称相对应才可以。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">       <span class="keyword">private</span> String myName;</span><br><span class="line">      </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">this</span>.id = id;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> id;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyName</span><span class="params">(String myName)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">this</span>.myName = myName;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> String <span class="title">getMyName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> myName;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   Model model = <span class="keyword">new</span> Model();</span><br><span class="line">   model.setId(<span class="number">1</span>);</span><br><span class="line">   model.setMyName(<span class="string">"name5"</span>);</span><br><span class="line">   insertSql = <span class="string">"insert into test(name) values(:myName)"</span>;</span><br><span class="line">   paramSource = <span class="keyword">new</span> BeanPropertySqlParameterSource(model);</span><br><span class="line">   namedParameterJdbcTemplate.update(insertSql, paramSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>SimpleJdbcTemplate类</h1>
<p><strong>SimpleJdbcTemplate已经被废弃了，其Java 5的特性被转移到了JdbcTemplate中。</strong></p>
<p>SimpleJdbcTemplate类也是基于JdbcTemplate类。它支持JdbcTemplate的所有特性实现，提供了更简洁的代码实现。并且类似于NamedParameterJdbcTemplate，支持命名参数特性，如<code>queryForList(String sql, SqlParameterSource args)</code>和<code>queryForList(String sql, Map &lt;String, ?&gt; args)</code> 。</p>
<p>SimpleJdbcTemplate主要提供两类方法：query及queryForXXX方法、update及batchUpdate方法。并可以使用DataSource、JdbcTemplate或NamedParameterJdbcTemplate对象作为构造器参数初始化。</p>
<p>SimpleJdbcTemplate还提供如下方法用于获取JdbcTemplate和NamedParameterJdbcTemplate：</p>
<p>1）获取JdbcTemplate对象方法：<code>JdbcOperations getJdbcOperations()</code>（JdbcOperations是JdbcTemplate的接口）</p>
<p>2）获取NamedParameterJdbcTemplate对象方法：<br>
<code>NamedParameterJdbcOperations getNamedParameterJdbcOperations()</code>（NamedParameterJdbcOperations是NamedParameterJdbcTemplate的接口）</p>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleJdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">//还支持DataSource和NamedParameterJdbcTemplate作为构造器参数</span></span><br><span class="line">   SimpleJdbcTemplate simpleJdbcTemplate = <span class="keyword">new</span> SimpleJdbcTemplate(jdbcTemplate);</span><br><span class="line"> </span><br><span class="line">   String insertSql = <span class="string">"insert into test(id, name) values(?, ?)"</span>;</span><br><span class="line">   simpleJdbcTemplate.update(insertSql, <span class="number">10</span>, <span class="string">"name5"</span>);</span><br><span class="line">   String selectSql = <span class="string">"select * from test where id=? and name=?"</span>;</span><br><span class="line">   List&lt;Map&lt;String, Object&gt;&gt; result = simpleJdbcTemplate.queryForList(selectSql, <span class="number">10</span>, <span class="string">"name5"</span>);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result.size());</span><br><span class="line"> </span><br><span class="line">   RowMapper&lt;UserModel&gt; mapper = <span class="keyword">new</span> RowMapper&lt;UserModel&gt;()&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> UserModel <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">           UserModel model = <span class="keyword">new</span> UserModel();</span><br><span class="line">           model.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">           model.setMyName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">           <span class="keyword">return</span> model;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br><span class="line">   List&lt;UserModel&gt; result2 = simpleJdbcTemplate.query(selectSql, mapper, <span class="number">10</span>, <span class="string">"name5"</span>);</span><br><span class="line">   Assert.assertEquals(<span class="number">1</span>, result2.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>SimpleJdbcInsert类</h1>
<p>SimpleJdbcInsert：本类用于简化插入操作，根据数据库元数据进行插入数据，提供三种类型方法：</p>
<ul>
<li>execute方法用于普通插入。</li>
<li>executeAndReturnKey及executeAndReturnKeyHolder方法用于插入时获取主键值。</li>
<li>executeBatch方法用于批处理。</li>
</ul>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcInsert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleJdbcInsertTest</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">               <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">               <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * new SimpleJdbcInsert(jdbcTemplate)：首次通过DataSource对象或JdbcTemplate对象初始化SimpleJdbcInsert；</span></span><br><span class="line"><span class="comment">    * insert.withTableName("test")：用于设置数据库表名；</span></span><br><span class="line"><span class="comment">    * args：用于指定插入时列名及值，如本例中只有name列名，即编译后的sql类似于“insert into test(name) values(?)”；</span></span><br><span class="line"><span class="comment">    * insert.compile()：可选的编译步骤，在调用执行方法时自动编译，编译后不能再对insert对象修改；</span></span><br><span class="line"><span class="comment">    * 执行：</span></span><br><span class="line"><span class="comment">    * 1. execute方法用于执行普通插入；</span></span><br><span class="line"><span class="comment">    * 2. executeAndReturnKey用于执行并获取自动生成主键（注意是Number类型），</span></span><br><span class="line"><span class="comment">    *      必须首先通过setGeneratedKeyName设置主键然后才能获取，</span></span><br><span class="line"><span class="comment">    *      如果想获取复合主键请使用setGeneratedKeyNames描述主键然后通过executeReturningKeyHolder获取复合主键KeyHolder对象；</span></span><br><span class="line"><span class="comment">    * 3. executeBatch用于批处理；</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleJdbcInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SimpleJdbcInsert insert = <span class="keyword">new</span> SimpleJdbcInsert(jdbcTemplate);</span><br><span class="line">       insert.withTableName(<span class="string">"test"</span>);</span><br><span class="line">       Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">       args.put(<span class="string">"name"</span>, <span class="string">"name5"</span>);</span><br><span class="line">       insert.compile();</span><br><span class="line">       <span class="comment">//1.普通插入</span></span><br><span class="line">       insert.execute(args);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">       <span class="comment">//2.插入时获取主键值</span></span><br><span class="line">       insert = <span class="keyword">new</span> SimpleJdbcInsert(jdbcTemplate);</span><br><span class="line">       insert.withTableName(<span class="string">"test"</span>);</span><br><span class="line">       insert.setGeneratedKeyName(<span class="string">"id"</span>);</span><br><span class="line">       Number id = insert.executeAndReturnKey(args);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, id);</span><br><span class="line">       <span class="comment">//3.批处理</span></span><br><span class="line">       insert = <span class="keyword">new</span> SimpleJdbcInsert(jdbcTemplate);</span><br><span class="line">       insert.withTableName(<span class="string">"test"</span>);</span><br><span class="line">       insert.setGeneratedKeyName(<span class="string">"id"</span>);</span><br><span class="line">       <span class="keyword">int</span>[] updateCount = insert.executeBatch(<span class="keyword">new</span> Map[] &#123;args, args, args&#125;);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, updateCount[<span class="number">0</span>]);</span><br><span class="line">       Assert.assertEquals(<span class="number">5</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>SimpleJdbcCall类</h1>
<p>SimpleJdbcCall：本类用于简化存储过程及自定义函数调用。详细见示例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.MapSqlParameterSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.SqlParameterSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcCall;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleJdbcCallTest</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">               <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">               <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line"> </span><br><span class="line">       String createHsqldbFunctionSql =</span><br><span class="line">               <span class="string">"CREATE FUNCTION FUNCTION_TEST(str VARCHAR(100)) "</span> +</span><br><span class="line">                       <span class="string">"returns INT begin atomic return length(str);end"</span>;</span><br><span class="line">       jdbcTemplate.update(createHsqldbFunctionSql);</span><br><span class="line">       String createHsqldbProcedureSql =</span><br><span class="line">               <span class="string">"CREATE PROCEDURE PROCEDURE_TEST"</span> +</span><br><span class="line">                       <span class="string">"(INOUT inOutName VARCHAR(100), OUT outId INT) "</span> +</span><br><span class="line">                       <span class="string">"MODIFIES SQL DATA "</span> +</span><br><span class="line">                       <span class="string">"BEGIN ATOMIC "</span> +</span><br><span class="line">                       <span class="string">"  insert into test(name) values (inOutName); "</span> +</span><br><span class="line">                       <span class="string">"  SET outId = IDENTITY(); "</span> +</span><br><span class="line">                       <span class="string">"  SET inOutName = 'Hello,' + inOutName; "</span> +</span><br><span class="line">                       <span class="string">"END"</span>;</span><br><span class="line">       jdbcTemplate.execute(createHsqldbProcedureSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate.execute(<span class="string">"DROP FUNCTION FUNCTION_TEST"</span>);</span><br><span class="line">       jdbcTemplate.execute(<span class="string">"DROP PROCEDURE PROCEDURE_TEST"</span>);</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * new SimpleJdbcCall(getMysqlDataSource())：通过DataSource对象或JdbcTemplate对象初始化SimpleJdbcCall；</span></span><br><span class="line"><span class="comment">    * withFunctionName("FUNCTION_TEST")：定义自定义函数名；自定义函数sql语句将被编译为类似于&#123;?= call …&#125;形式；</span></span><br><span class="line"><span class="comment">    * declareParameters：描述参数类型，使用方式与StoredProcedure对象一样；</span></span><br><span class="line"><span class="comment">    * 执行：调用execute方法执行自定义函数；</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleJdbcCall1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       JdbcTemplate mysqlJdbcTemplate = <span class="keyword">new</span> JdbcTemplate(getMysqlDataSource());</span><br><span class="line"> </span><br><span class="line">       String createFunctionSql =</span><br><span class="line">               <span class="string">"CREATE FUNCTION FUNCTION_TEST(str VARCHAR(100)) "</span> +</span><br><span class="line">                       <span class="string">"returns INT return LENGTH(str)"</span>;</span><br><span class="line">       String dropFunctionSql = <span class="string">"DROP FUNCTION IF EXISTS FUNCTION_TEST"</span>;</span><br><span class="line">       mysqlJdbcTemplate.update(dropFunctionSql);</span><br><span class="line">       mysqlJdbcTemplate.update(createFunctionSql);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">//此处用mysql</span></span><br><span class="line">       SimpleJdbcCall call = <span class="keyword">new</span> SimpleJdbcCall(mysqlJdbcTemplate);</span><br><span class="line">       call.withFunctionName(<span class="string">"FUNCTION_TEST"</span>);</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlOutParameter(<span class="string">"result"</span>, Types.INTEGER));</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlParameter(<span class="string">"str"</span>, Types.VARCHAR));</span><br><span class="line">       Map&lt;String, Object&gt; outVlaues = call.execute(<span class="string">"test"</span>);</span><br><span class="line">       Assert.assertEquals(<span class="number">4</span>, outVlaues.get(<span class="string">"result"</span>));</span><br><span class="line">       outVlaues = call.execute(<span class="string">"test1"</span>);</span><br><span class="line">       Assert.assertEquals(<span class="number">5</span>, outVlaues.get(<span class="string">"result"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 调用hsqldb数据库自定义函数与调用mysql自定义函数完全不同，详见StoredProcedure中的解释。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleJdbcCall2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//调用hsqldb自定义函数得使用如下方式</span></span><br><span class="line">       SimpleJdbcCall call = <span class="keyword">new</span> SimpleJdbcCall(jdbcTemplate);</span><br><span class="line">       call.withProcedureName(<span class="string">"FUNCTION_TEST"</span>);</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlReturnResultSet(<span class="string">"result"</span>, <span class="keyword">new</span> ResultSetExtractor&lt;Integer&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> Integer <span class="title">extractData</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException,</span></span><br><span class="line"><span class="function">                   DataAccessException </span>&#123;</span><br><span class="line">               <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">                   <span class="keyword">return</span> rs.getInt(<span class="number">1</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;));</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlParameter(<span class="string">"str"</span>, Types.VARCHAR));</span><br><span class="line">       Map&lt;String, Object&gt; outVlaues = call.execute(<span class="string">"test"</span>);</span><br><span class="line">       Assert.assertEquals(<span class="number">4</span>, outVlaues.get(<span class="string">"result"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 存储过程与自定义函数调用不同的是使用withProcedureName来指定存储过程名字，其他参数描述等完全一样。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleJdbcCall3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SimpleJdbcCall call = <span class="keyword">new</span> SimpleJdbcCall(jdbcTemplate);</span><br><span class="line">       call.withProcedureName(<span class="string">"PROCEDURE_TEST"</span>);</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlInOutParameter(<span class="string">"inOutName"</span>, Types.VARCHAR));</span><br><span class="line">       call.declareParameters(<span class="keyword">new</span> SqlOutParameter(<span class="string">"outId"</span>, Types.INTEGER));</span><br><span class="line">       SqlParameterSource params = <span class="keyword">new</span> MapSqlParameterSource().addValue(<span class="string">"inOutName"</span>, <span class="string">"test"</span>);</span><br><span class="line">       Map&lt;String, Object&gt; outVlaues = call.execute(params);</span><br><span class="line">       Assert.assertEquals(<span class="string">"Hello,test"</span>, outVlaues.get(<span class="string">"inOutName"</span>));</span><br><span class="line">       Assert.assertEquals(<span class="number">0</span>, outVlaues.get(<span class="string">"outId"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">getMysqlDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//1.首先启动mysql（本书使用5.4.3版本），其次登录mysql创建test数据库</span></span><br><span class="line">       String url = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">       <span class="comment">//在进行测试前，请下载并添加mysql-connector-java-5.1.10.jar到classpath</span></span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, <span class="string">"root"</span>, <span class="string">"root"</span>);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">       <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>获取自动生成的主键</h1>
<p>有许多数据库提供自动生成主键的能力，因此我们可能需要获取这些自动生成的主键，JDBC 3.0标准支持获取自动生成的主键，且必须数据库支持自动生成键获取。</p>
<p>GeneratedKeyHolder实现了KeyHolder接口，用于获取自动生成的主键或复合主键，如使用getKey方法获取自动生成的主键。</p>
<p>JdbcTemplate类和SimpleJdbcInsert均可以在执行insert操作时获取到数据库自动生成的主键，详情见示例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter7.demo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.PreparedStatementCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.object.SqlUpdate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.GeneratedKeyHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.KeyHolder;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FetchKeyTest</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">               <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">               <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用JdbcTemplate的update(final PreparedStatementCreator psc, final KeyHolder generatedKeyHolder)方法执行需要返回自动生成主键的插入语句，</span></span><br><span class="line"><span class="comment">    * 其中psc用于创建PreparedStatement并指定自动生成键，如“prepareStatement(insertSql, new String[]&#123;"ID"&#125;)”。</span></span><br><span class="line"><span class="comment">    * generatedKeyHolder是KeyHolder类型，用于获取自动生成的主键或复合主键，如使用getKey方法获取自动生成的主键。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFetchKey1</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> String insertSql = <span class="string">"insert into test(name) values('name5')"</span>;</span><br><span class="line">       KeyHolder generatedKeyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</span><br><span class="line">       jdbcTemplate.update(<span class="keyword">new</span> PreparedStatementCreator() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span><span class="params">(Connection conn)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> conn.prepareStatement(insertSql, <span class="keyword">new</span> String[]&#123;<span class="string">"ID"</span>&#125;);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, generatedKeyHolder);</span><br><span class="line">       Assert.assertEquals(<span class="number">0</span>, generatedKeyHolder.getKey());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>批量操作示例</h1>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter7.demo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BatchPreparedStatementSetter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.SqlParameterSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.SqlParameterSourceUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcInsert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchUpdateTest</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">               <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">               <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * JdbcTemplate批处理：支持普通的批处理及占位符批处理。</span></span><br><span class="line"><span class="comment">    * 直接调用batchUpdate方法执行需要批处理的语句即可。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchUpdate1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String insertSql = <span class="string">"insert into test(name) values('name5')"</span>;</span><br><span class="line">       String[] batchSql = <span class="keyword">new</span> String[] &#123;insertSql, insertSql&#125;;</span><br><span class="line">       jdbcTemplate.batchUpdate(batchSql);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * JdbcTemplate还可以通过batchUpdate(String sql, final BatchPreparedStatementSetter pss)方法进行批处理，</span></span><br><span class="line"><span class="comment">    * 该方式使用预编译语句，然后通过BatchPreparedStatementSetter实现进行设值（setValues）及指定批处理大小（getBatchSize）。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchUpdate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String insertSql = <span class="string">"insert into test(name) values(?)"</span>;</span><br><span class="line">       <span class="keyword">final</span> String[] batchValues = <span class="keyword">new</span> String[] &#123;<span class="string">"name5"</span>, <span class="string">"name6"</span>&#125;;</span><br><span class="line">       jdbcTemplate.batchUpdate(insertSql, <span class="keyword">new</span> BatchPreparedStatementSetter() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">               ps.setString(<span class="number">1</span>, batchValues[i]);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBatchSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> batchValues.length;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * NamedParameterJdbcTemplate批处理：支持命名参数批处理。</span></span><br><span class="line"><span class="comment">    * 通过batchUpdate(String sql, SqlParameterSource[] batchArgs)方法进行命名参数批处理，batchArgs指定批处理数据集。</span></span><br><span class="line"><span class="comment">    * SqlParameterSourceUtils.createBatch用于根据JavaBean对象或者Map创建相应的BeanPropertySqlParameterSource或MapSqlParameterSource。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchUpdate3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       NamedParameterJdbcTemplate namedParameterJdbcTemplate = <span class="keyword">new</span> NamedParameterJdbcTemplate(jdbcTemplate);</span><br><span class="line">       String insertSql = <span class="string">"insert into test(name) values(:myName)"</span>;</span><br><span class="line">       UserModel model = <span class="keyword">new</span> UserModel();</span><br><span class="line">       model.setMyName(<span class="string">"name5"</span>);</span><br><span class="line">       SqlParameterSource[] params = SqlParameterSourceUtils.createBatch(<span class="keyword">new</span> Object[] &#123;model, model&#125;);</span><br><span class="line">       namedParameterJdbcTemplate.batchUpdate(insertSql, params);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * SimpleJdbcTemplate批处理：以更简单的方式进行批处理。</span></span><br><span class="line"><span class="comment">    * 使用batchUpdate(String sql, List&lt;Object[]&gt; batchArgs)方法完成占位符批处理，当然也支持命名参数批处理等。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchUpdate4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SimpleJdbcTemplate simpleJdbcTemplate = <span class="keyword">new</span> SimpleJdbcTemplate(jdbcTemplate);</span><br><span class="line">       String insertSql = <span class="string">"insert into test(name) values(?)"</span>;</span><br><span class="line">       List&lt;Object[]&gt; params = <span class="keyword">new</span> ArrayList&lt;Object[]&gt;();</span><br><span class="line">       params.add(<span class="keyword">new</span> Object[]&#123;<span class="string">"name5"</span>&#125;);</span><br><span class="line">       params.add(<span class="keyword">new</span> Object[]&#123;<span class="string">"name5"</span>&#125;);</span><br><span class="line">       simpleJdbcTemplate.batchUpdate(insertSql, params);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * SimpleJdbcInsert批处理：</span></span><br><span class="line"><span class="comment">    * 使用executeBatch(Map&lt;String, Object&gt;[] batch)方法执行批处理。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchUpdate5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SimpleJdbcInsert insert = <span class="keyword">new</span> SimpleJdbcInsert(jdbcTemplate);</span><br><span class="line">       insert.withTableName(<span class="string">"test"</span>);</span><br><span class="line">       Map&lt;String, Object&gt; valueMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">       valueMap.put(<span class="string">"name"</span>, <span class="string">"name5"</span>);</span><br><span class="line">       insert.executeBatch(<span class="keyword">new</span> Map[] &#123;valueMap, valueMap&#125;);</span><br><span class="line">       Assert.assertEquals(<span class="number">2</span>, jdbcTemplate.queryForInt(<span class="string">"select count(*) from test"</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Spring容器中使用JDBC模版类</h1>
<h2 id="方法一：使用JdbcDaoSupport">方法一：使用JdbcDaoSupport</h2>
<p>大多数情况下Spring JDBC都是与IOC容器一起使用。通过配置方式使用Spring JDBC。</p>
<p>而且大部分时间都是使用JdbcTemplate类（或SimpleJdbcTemplate和NamedParameterJdbcTemplate）进行开发，即可能80%时间使用JdbcTemplate类，而只有20%时间使用其他类开发，符合80/20法则。</p>
<p>Spring JDBC通过实现DaoSupport接口来支持一致的数据库访问。</p>
<p>Spring JDBC提供如下DaoSupport实现类：</p>
<ul>
<li>JdbcDaoSupport：用于支持一致的JdbcTemplate访问；</li>
<li>NamedParameterJdbcDaoSupport:继承JdbcDaoSupport，同时提供NamedParameterJdbcTemplate访问；</li>
<li>SimpleJdbcDaoSupport：继承JdbcDaoSupport，同时提供SimpleJdbcTemplate访问。</li>
</ul>
<p>由于JdbcTemplate、NamedParameterJdbcTemplate、SimpleJdbcTemplate类使用DataSourceUtils获取及释放连接，而且连接是与线程绑定的，因此这些JDBC模板类是线程安全的，即JdbcTemplate对象可以在多线程中重用。</p>
<p>示例代码如下：</p>
<ol>
<li>DAO接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.javass.spring.chapter7.demo.UserModel;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(UserModel model)</span></span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>DAO实现类（继承SimpleJdbcDaoSupport类）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.javass.spring.chapter7.demo.UserModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IUserDaoImpl</span> <span class="keyword">extends</span> <span class="title">SimpleJdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String INSERT_SQL = <span class="string">"insert into test(name) values(:myName)"</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String COUNT_ALL_SQL = <span class="string">"select count(*) from test"</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(UserModel model)</span> </span>&#123;</span><br><span class="line">       getSimpleJdbcTemplate().update(INSERT_SQL, <span class="keyword">new</span> BeanPropertySqlParameterSource(model));</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> getJdbcTemplate().queryForInt(COUNT_ALL_SQL);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Spring配置文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       首先定义抽象的abstractDao，其有一个dataSource属性，从而可以让继承的子类自动继承dataSource属性注入；</span></span><br><span class="line"><span class="comment">       然后定义userDao，且继承abstractDao，从而继承dataSource注入。</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abstractDao"</span> <span class="attr">abstract</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>    </span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"demo.dao.IUserDaoImpl"</span> <span class="attr">parent</span>=<span class="string">"abstractDao"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       PropertyPlaceholderConfigurer用于替换配置元数据，</span></span><br><span class="line"><span class="comment">       如此处将对bean定义中的$&#123;…&#125;占位符资源用“resources.properties”中相应的元素替换。</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:resources.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       dataSource定义数据源，此处使用proxool数据库连接池，并使用LazyConnectionDataSourceProxy包装它，从而延迟获取数据库连接；</span></span><br><span class="line"><span class="comment">       $&#123;db.driver.class&#125;将被“resources.properties”中的“db.driver.class”元素属性值替换。</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   ProxoolDataSource属性含义如下：</span></span><br><span class="line"><span class="comment">   * driver：指定数据库驱动；</span></span><br><span class="line"><span class="comment">   * driverUrl：数据库连接；</span></span><br><span class="line"><span class="comment">   * username：用户名；</span></span><br><span class="line"><span class="comment">   * password：密码；</span></span><br><span class="line"><span class="comment">   * maximumConnectionCount：连接池最大连接数量；</span></span><br><span class="line"><span class="comment">   * minimumConnectionCount：连接池最小连接数量；</span></span><br><span class="line"><span class="comment">   * statistics：连接池使用样本状况统计；如1m,15m,1h,1d表示没1分钟、15分钟、1小时及1天进行一次样本统计；</span></span><br><span class="line"><span class="comment">   * simultaneousBuildThrottle：一次可以创建连接的最大数量；</span></span><br><span class="line"><span class="comment">   * trace：true表示被执行的每个sql都将被记录（DEBUG级别时被打印到相应的日志文件）；</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.LazyConnectionDataSourceProxy"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetDataSource"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.logicalcobwebs.proxool.ProxoolDataSource"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver.class&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maximumConnectionCount"</span> <span class="attr">value</span>=<span class="string">"$&#123;proxool.maxConnCount&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minimumConnectionCount"</span> <span class="attr">value</span>=<span class="string">"$&#123;proxool.minConnCount&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"statistics"</span> <span class="attr">value</span>=<span class="string">"$&#123;proxool.statistics&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"simultaneousBuildThrottle"</span> <span class="attr">value</span>=<span class="string">"$&#123;proxool.simultaneousBuildThrottle&#125;"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trace"</span> <span class="attr">value</span>=<span class="string">"$&#123;proxool.trace&#125;"</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>测试类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.javass.spring.chapter7.demo.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> junit.framework.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJdbcInApplicationContextTest</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@BeforeClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String url = <span class="string">"jdbc:hsqldb:mem:test"</span>;</span><br><span class="line">       String username = <span class="string">"sa"</span>;</span><br><span class="line">       String password = <span class="string">""</span>;</span><br><span class="line">       DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource(url, username, password);</span><br><span class="line">       dataSource.setDriverClassName(<span class="string">"org.hsqldb.jdbcDriver"</span>);</span><br><span class="line">       jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@AfterClass</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       jdbcTemplate = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//id自增主键从0开始</span></span><br><span class="line">       String createTableSql = <span class="string">"create memory table test"</span> +</span><br><span class="line">               <span class="string">"(id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, "</span> +</span><br><span class="line">               <span class="string">"name varchar(100))"</span>;</span><br><span class="line">       jdbcTemplate.update(createTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String dropTableSql = <span class="string">"drop table test"</span>;</span><br><span class="line">       jdbcTemplate.execute(dropTableSql);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 首先读取配置文件，获取IUserDao接口实现，然后再调用IUserDao接口方法，进行数据库操作。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBestPractice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String[] configLocations = <span class="keyword">new</span> String[] &#123;<span class="string">"classpath:applicationContext-jdbc.xml"</span>&#125;;</span><br><span class="line">       ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(configLocations);</span><br><span class="line">       IUserDao userDao = ctx.getBean(IUserDao.class);</span><br><span class="line">       UserModel model = <span class="keyword">new</span> UserModel();</span><br><span class="line">       model.setMyName(<span class="string">"test"</span>);</span><br><span class="line">       userDao.save(model);</span><br><span class="line">       Assert.assertEquals(<span class="number">1</span>, userDao.countAll());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方法二：自动装配JdbcTemplate">方法二：自动装配JdbcTemplate</h2>
<h3 id="配置JdbcTemplate">配置JdbcTemplate</h3>
<p>为了让JdbcTemplate正常工作，只需要为其设置DataSource就可以了，这使得在Spring中配置JdbcTemplate非常容易，如下面的@Bean方法所示：</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584812482_20200322013452807_31834.png" alt></p>
<p>在这里，DataSource是通过构造器参数注入进来的。这里所引用的dataSourcebean可以是javax.sql.DataSource的任意实现。</p>
<h3 id="将jdbcTemplate装配到Repository中">将jdbcTemplate装配到Repository中</h3>
<p>现在，我们可以将jdbcTemplate装配到Repository中并使用它来访问数据库。例如，SpitterRepository使用了JdbcTemplate：</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584812481_20200322013452497_3426.png" alt></p>
<p>在这里，JdbcSpitterRepository类上使用了@Repository注解，这表明它将会在组件扫描的时候自动创建。它的构造器上使用了@Inject注解，因此在创建的时候，会自动获得一个JdbcOperations对象。JdbcOperations是一个接口，定义了JdbcTemplate所实现的操作。通过注入JdbcOperations，而不是具体的JdbcTemplate，能够保证JdbcSpitterRepository通过JdbcOperations接口达到与JdbcTemplate保持松耦合。</p>
<p>作为另外一种组件扫描和自动装配的方案，我们可以将JdbcSpitterRepository显式声明为Spring中的bean，如下所示：</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584812481_20200322013452082_31733.png" alt></p>
<p>在Repository中具备可用的JdbcTemplate后，我们可以极大地简化程序清单10.4中的addSpitter()方法。基于JdbcTemplate的addSpitter()方法示例如下：</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584812479_20200322013451871_5618.png" alt></p>
<p>这个版本的addSpitter()方法简单多了。这里没有了创建连接和语句的代码，也没有异常处理的代码，只剩下单纯的数据插入代码。</p>
<p>不能因为你看不到这些样板代码，就意味着它们不存在。样板代码被巧妙地隐藏到JDBC模板类中了。当update()方法被调用的时候JdbcTemplate将会获取连接、创建语句并执行插入SQL。</p>
<p>在这里，你也看不到对SQLException处理的代码。在内部，JdbcTemplate将会捕获所有可能抛出的SQLException，并将通用的SQLException转换为表10.1所列的那些更明确的数据访问异常，然后将其重新抛出。因为Spring的数据访问异常都是运行时异常，所以我们不必在addSpring()方法中进行捕获。</p>

      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">SPRING学习笔记</a></li>
            <li>43-JDBC模板类</li>
          
  </ul>

    
    
    
  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">JdbcTemplate类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主要JDBC操作方法"><span class="nav-text">主要JDBC操作方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简易的queryForXXX方法"><span class="nav-text">简易的queryForXXX方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">Jdbc模板回调类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Statement对象回调"><span class="nav-text">Statement对象回调</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结果集处理回调"><span class="nav-text">结果集处理回调</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">NamedParameterJdbcTemplate类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">SimpleJdbcTemplate类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">SimpleJdbcInsert类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">SimpleJdbcCall类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">获取自动生成的主键</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">批量操作示例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">Spring容器中使用JDBC模版类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方法一：使用JdbcDaoSupport"><span class="nav-text">方法一：使用JdbcDaoSupport</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法二：自动装配JdbcTemplate"><span class="nav-text">方法二：自动装配JdbcTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置JdbcTemplate"><span class="nav-text">配置JdbcTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将jdbcTemplate装配到Repository中"><span class="nav-text">将jdbcTemplate装配到Repository中</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="jiateng.jiang"
    src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">jiateng.jiang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiateng.jiang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  






  <script src="/js/local-search.js"></script>








<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '100%'
      });
    });
  }, window.PDFObject);
}
</script>





  

  

  

</body>
</html>
