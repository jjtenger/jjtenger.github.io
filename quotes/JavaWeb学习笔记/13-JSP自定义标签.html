<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.json',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="相关API类继承关系JspTag接口JspTag接口是所有自定义标签的父接口，它是JSP2.0中新定义的一个标记接口，没有任何属性和方法。JspTag接口有Tag和SimpleTag两个直接子接口，JSP2.0以前的版本中只有Tag接口，所以把实现Tag接口的自定义标签也叫做传统标签，把实现SimpleTag接口的自定义标签叫做简单标签。">
<meta property="og:type" content="website">
<meta property="og:title" content="JJT-个人Wiki">
<meta property="og:url" content="https:&#x2F;&#x2F;hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com&#x2F;quotes&#x2F;JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0&#x2F;13-JSP%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE.html">
<meta property="og:site_name" content="JJT-个人Wiki">
<meta property="og:description" content="相关API类继承关系JspTag接口JspTag接口是所有自定义标签的父接口，它是JSP2.0中新定义的一个标记接口，没有任何属性和方法。JspTag接口有Tag和SimpleTag两个直接子接口，JSP2.0以前的版本中只有Tag接口，所以把实现Tag接口的自定义标签也叫做传统标签，把实现SimpleTag接口的自定义标签叫做简单标签。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584775789_20200321152136612_13194.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584775789_20200321152136298_16572.png">
<meta property="og:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584775788_20200321152136088_16650.png">
<meta property="og:updated_time" content="2020-12-15T11:07:33.020Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;hexo-1300861231.cos.ap-shanghai.myqcloud.com&#x2F;1584775789_20200321152136612_13194.png">

<link rel="canonical" href="https://hexo-pages-1300861231.cos-website.ap-shanghai.myqcloud.com/quotes/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13-JSP%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>

  <title> | JJT-个人Wiki
  </title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JJT-个人Wiki</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">you see see you one day day</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content">
            

  <div class="posts-expand">
    
    
    
    <div class="post-block" lang="zh-CN">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">
</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">JAVAWEB学习笔记</a></li>
            <li>13-JSP自定义标签</li>
          
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
          <h1>相关API类继承关系</h1><p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584775789_20200321152136612_13194.png" alt></p><h2 id="JspTag接口">JspTag接口</h2><p>JspTag接口是所有自定义标签的父接口，它是JSP2.0中新定义的一个标记接口，没有任何属性和方法。</p><p>JspTag接口有Tag和SimpleTag两个直接子接口，JSP2.0以前的版本中只有Tag接口，所以把实现Tag接口的自定义标签也叫做传统标签，把实现SimpleTag接口的自定义标签叫做简单标签。</p><a id="more"></a>




<h1>传统标签接口开发</h1>
<h2 id="接口及实现类">接口及实现类</h2>
<h3 id="Tag接口">Tag接口</h3>
<p>Tag接口是所有传统标签的父接口，其中定义了两个重要方法（doStartTag、doEndTag）方法和四个常量（EVAL_BODY_INCLUDE、SKIP_BODY、EVAL_PAGE、SKIP_PAGE）。</p>
<p>开发自定义标签时可以在doStartTag方法和doEndTag方法体内编写Java程序代码来实现具体的功能，通过控制doStartTag方法和doEndTag方法的返回值，还可以告诉WEB容器是否执行自定义标签中的标签体内容和JSP页面中位于自定义标签的结束标记后面的内容。</p>
<p><strong>doStartTag方法</strong></p>
<p>WEB容器在解释执行JSP页面的过程中，遇到自定义标签的开始标记就会去调用标签处理器的doStartTag方法。</p>
<p>doStartTag方法执行完后可以向WEB容器返回常量EVAL_BODY_INCLUDE或SKIP_BODY。</p>
<ul>
<li>如果doStartTag方法返回EVAL_BODY_INCLUDE，WEB容器就会接着执行自定义标签的标签体；</li>
<li>如果doStartTag方法返回SKIP_BODY，WEB容器就会忽略自定义标签的标签体，直接解释执行自定义标签的结束标记。</li>
</ul>
<p><strong>doEndTag方法</strong></p>
<p>WEB容器解释执行到自定义标签的结束标记时，就会调用标签处理器的doEndTag方法。</p>
<p>doEndTag方法执行完后可以向WEB容器返回常量EVAL_PAGE或SKIP_PAGE。</p>
<ul>
<li>如果doEndTag方法返回常量EVAL_PAGE，WEB容器就会接着执行JSP页面中位于结束标记后面的JSP代码；</li>
<li>如果doEndTag方法返回SKIP_PAGE，WEB容器就会忽略JSP页面中位于结束标记后面的所有内容。</li>
</ul>
<h3 id="IterationTag接口">IterationTag接口</h3>
<p>IterationTag接口继承了Tag接口，并在Tag接口的基础上增加了一个doAfterBody方法和一个EVAL_BODY_AGAIN常量。实现IterationTag接口的标签除了可以完成Tag接口所能完成的功能外，还能够通知WEB容器是否重复执行标签体内容。</p>
<p><strong>doAfterBody方法</strong></p>
<p>对于实现了IterationTag接口的自定义标签，WEB容器在执行完自定义标签的标签体后，将调用标签处理器的doAfterBody方法。</p>
<p>doAfterBody方法可以向WEB容器返回常量EVAL_BODY_AGAIN或SKIP_BODY。如果doAfterBody方法返回EVAL_BODY_AGAIN，WEB容器就会把标签体内容再重复执行一次，执行完后接着再调用doAfterBody方法，如此往复，直到doAfterBody方法返回常量SKIP_BODY，WEB容器才会开始处理标签的结束标记和调用doEndTag方法。</p>
<p>可见，开发自定义标签时，可以通过控制doAfterBody方法的返回值来告诉WEB容器是否重复执行标签体内容，从而达到循环处理标签体内容的效果。例如，可以通过一个实现IterationTag接口的标签来迭代输出一个集合中的所有元素，在标签体部分指定元素的输出格式。</p>
<h3 id="IterationTag实现类TagSupport">IterationTag实现类TagSupport</h3>
<p>在JSP API中也提供了IterationTag接口的默认实现类TagSupport，我们在编写自定义标签的标签处理器类时，可以继承和扩展TagSupport类，这相比实现IterationTag接口将简化开发工作。</p>
<h3 id="BodyTag接口">BodyTag接口</h3>
<p>BodyTag接口继承了IterationTag接口，并在IterationTag接口的基础上增加了两个方法（setBodyContent、doInitBody）和一个EVAL_BODY_BUFFERED常量。实现BodyTag接口的标签除了可以完成IterationTag接口所能完成的功能，还可以对标签体内容进行修改。</p>
<h3 id="BodyTag实现类BodyTagSupport">BodyTag实现类BodyTagSupport</h3>
<p>在JSP API中也提供了BodyTag接口的实现类BodyTagSupport，我们在编写能够修改标签体内容的自定义标签的标签处理器类时，可以继承和扩展BodyTagSupport类，这相比实现BodyTag接口将简化开发工作。</p>
<h3 id="BodyContent对象">BodyContent对象</h3>
<p>BodyContent对象专门用于捕获标签体运行结果。</p>
<p>对于实现了BodyTag接口的自定义标签，标签处理器的doStartTag方法不仅可以返回前面讲解的常量EVAL_BODY_INCLUDE或SKIP_BODY，还可以返回常量EVAL_BODY_BUFFERED。</p>
<p>如果doStartTag方法返回EVAL_BODY_BUFFERED，WEB容器就会创建一个BodyContent对象，然后调用标签处理器的setBodyContent方法将BodyContent对象传递给标签处理器，然后将标签体的执行结果写入到BodyContent对象中。</p>
<p>在标签处理器的后续事件方法中，可以通过先前保存的BodyContent对象来获取标签体的执行结果，然后调用BodyContent对象特有的方法对BodyContent对象中的内容（即标签体的执行结果）进行修改和控制其输出。</p>
<h3 id="传统标签接口方法返回值总结">传统标签接口方法返回值总结</h3>
<p>传统标签接口中方法返回值说明</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584775789_20200321152136298_16572.png" alt></p>
<h2 id="传统标签开发步骤">传统标签开发步骤</h2>
<p>1、编写一个实现Tag接口的Java类(标签处理器类)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.PageContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.Tag;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JSP标签处理器类：实现Tag接口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewIPTag</span> <span class="keyword">implements</span> <span class="title">Tag</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//接收传递进来的PageContext对象</span></span><br><span class="line">   <span class="keyword">private</span> PageContext pageContext;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"调用doEndTag()方法"</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"调用doStartTag()方法"</span>);</span><br><span class="line">       HttpServletRequest request =(HttpServletRequest) pageContext.getRequest();</span><br><span class="line">       JspWriter out = pageContext.getOut();</span><br><span class="line">       String ip = request.getRemoteAddr();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//这里输出的时候会抛出IOException异常</span></span><br><span class="line">           out.write(ip);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           <span class="comment">//捕获IOException异常后继续抛出</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Tag <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"调用release()方法"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageContext</span><span class="params">(PageContext pageContext)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"setPageContext(PageContext pageContext)"</span>);</span><br><span class="line">       <span class="keyword">this</span>.pageContext = pageContext;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Tag arg0)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、在WEB-INF/目录下新建tld文件，在tld文件中对标签处理器类进行描述。</p>
<p>tld文件不一定放在WEB-INF目录下，也可以放在别的目录，但习惯是放在WEB-INF目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!-- description用来添加对taglib(标签库)的描述 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>jjt开发的自定义标签库<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--taglib(标签库)的版本号 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>JJT_TagLibrary<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       为自定义标签库设置一个uri，uri以/开头，/后面的内容随便写，如这里的/jjt，</span></span><br><span class="line"><span class="comment">       在Jsp页面中引用标签库时，需要通过uri找到标签库</span></span><br><span class="line"><span class="comment">       在Jsp页面中就要这样引入标签库：&lt;%@taglib uri="/jjt" prefix="jjt"%&gt;</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">uri</span>&gt;</span>/jjt<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--一个taglib(标签库)中包含多个自定义标签，每一个自定义标签使用一个tag标记来描述  --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 一个tag标记对应一个自定义标签 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">description</span>&gt;</span>这个标签的作用是用来输出客户端的IP地址<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           为标签处理器类配一个标签名，在Jsp页面中使用标签时是通过标签名来找到要调用的标签处理器类的</span></span><br><span class="line"><span class="comment">           通过viewIP就能找到对应的me.gacl.web.tag.ViewIPTag类</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>viewIP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 标签对应的处理器类--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.ViewIPTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、在Jsp页面中使用自定义标签：</p>
<p>1） 使用&quot; <code>&lt;%@taglib uri=&quot;标签库的uri&quot; prefix=&quot;标签的使用前缀&quot;%&gt;</code> &quot;指令引入要使用的标签库。</p>
<p>2） 通过 <code>&lt;标签前缀:标签名.../&gt;</code> 的方式使用自定义标签。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!-- 使用taglib指令引用gacl标签库，标签库的前缀(prefix)可以随便设置，如这里设置成 prefix=<span class="string">"jjt"</span> --&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/jjt"</span>  prefix=<span class="string">"jjt"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;输出客户端的IP&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">你的IP地址是(使用java代码获取输出)：</span><br><span class="line">&lt;%</span><br><span class="line">   <span class="comment">//在jsp页面中使用java代码获取客户端IP地址</span></span><br><span class="line">   String ip = request.getRemoteAddr();</span><br><span class="line">   out.write(ip);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">你的IP地址是(使用自定义标签获取输出)：</span><br><span class="line">&lt;%--使用自定义标签viewIP --%&gt;</span><br><span class="line">&lt;jjt:viewIP/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="传统标签的执行过程分析">传统标签的执行过程分析</h2>
<p>JSP引擎遇到自定义标签时，首先创建标签处理器类的实例对象，然后按照JSP规范定义的执行流程依次调用它的方法。</p>
<ul>
<li>public void setPageContext(PageContext pc)， JSP引擎实例化标签处理器后，将调用setPageContext方法将JSP页面的pageContext对象传递给标签处理器，标签处理器以后可以通过这个pageContext对象与JSP页面进行通信。</li>
<li>public void setParent(Tag t)，setPageContext方法执行完后，WEB容器接着调用的setParent方法将当前标签的父标签传递给当前标签处理器，如果当前标签没有父标签，则传递给setParent方法的参数值为null。</li>
<li>public int doStartTag()，调用了setPageContext方法和setParent方法之后，WEB容器执行到自定义标签的开始标记时，就会调用标签处理器的doStartTag方法。</li>
<li>public int doEndTag()，WEB容器执行完自定义标签的标签体后，就会接着去执行自定义标签的结束标记，此时，WEB容器会去调用标签处理器的doEndTag方法。</li>
<li>public void release()，通常WEB容器执行完自定义标签后，标签处理器会驻留在内存中，为其它请求服务器，直至停止web应用时，web容器才会调用release方法。</li>
</ul>
<p>通过执行标签的jsp页面翻译后的Java源代码可以看到标签的执行流程：</p>
<p>Java源代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">_jspx_meth_xdp_005fviewIP_005f0</span><span class="params">(PageContext _jspx_page_context)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    PageContext pageContext = _jspx_page_context;</span><br><span class="line">    JspWriter out = _jspx_page_context.getOut();</span><br><span class="line">    <span class="comment">//  xdp:viewIP</span></span><br><span class="line">    me.gacl.web.tag.ViewIPTag _jspx_th_xdp_005fviewIP_005f0 = </span><br><span class="line">    (me.gacl.web.tag.ViewIPTag) _005fjspx_005ftagPool_005fxdp_005fviewIP_005fnobody.get(me.gacl.web.tag.ViewIPTag.class);</span><br><span class="line">    _jspx_th_xdp_005fviewIP_005f0.setPageContext(_jspx_page_context);</span><br><span class="line">    _jspx_th_xdp_005fviewIP_005f0.setParent(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">int</span> _jspx_eval_xdp_005fviewIP_005f0 = _jspx_th_xdp_005fviewIP_005f0.doStartTag();</span><br><span class="line">    <span class="keyword">if</span> (_jspx_th_xdp_005fviewIP_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) &#123;</span><br><span class="line">        _005fjspx_005ftagPool_005fxdp_005fviewIP_005fnobody.reuse(_jspx_th_xdp_005fviewIP_005f0);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _005fjspx_005ftagPool_005fxdp_005fviewIP_005fnobody.reuse(_jspx_th_xdp_005fviewIP_005f0);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是执行过程分析：</p>
<ul>
<li>首先实例化一个viewIP标签处理器类me.gacl.web.tag.ViewIPTag的对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  xdp:viewIP</span></span><br><span class="line">me.gacl.web.tag.ViewIPTag _jspx_th_xdp_005fviewIP_005f0 = </span><br><span class="line">(me.gacl.web.tag.ViewIPTag) _005fjspx_005ftagPool_005fxdp_005fviewIP_005fnobody.get(me.gacl.web.tag.ViewIPTag.class);</span><br></pre></td></tr></table></figure>
<ul>
<li>实例化标签处理器后，调用setPageContext方法将JSP页面的pageContext对象传递给标签处理器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_jspx_th_xdp_005fviewIP_005f0.setPageContext(_jspx_page_context);</span><br></pre></td></tr></table></figure>
<ul>
<li>setPageContext方法执行完后，调用的setParent方法将当前标签的父标签传递给当前标签处理器，如果当前标签没有父标签，则传递给setParent方法的参数值为null</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_jspx_th_xdp_005fviewIP_005f0.setParent(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>调用了setPageContext方法和setParent方法之后，WEB容器执行到自定义标签的开始标记时，就会调用标签处理器的doStartTag方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> _jspx_eval_xdp_005fviewIP_005f0 = _jspx_th_xdp_005fviewIP_005f0.doStartTag();</span><br></pre></td></tr></table></figure>
<ul>
<li>WEB容器执行完自定义标签的标签体后，就会接着去执行自定义标签的结束标记，此时，WEB容器会去调用标签处理器的doEndTag方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (_jspx_th_xdp_005fviewIP_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE)</span><br></pre></td></tr></table></figure>
<p>这就是自定义标签的执行流程。</p>
<h2 id="传统标签接口开发示例">传统标签接口开发示例</h2>
<h3 id="控制标签体是否执行">控制标签体是否执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.Tag;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.TagSupport;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制jsp页面某一部分内容是否执行</span></span><br><span class="line"><span class="comment">* 编写一个类实现tag接口，控制doStartTag()方法的返回值，如果这个方法返回EVAL_BODY_INCLUDE，则执行标签体，如果返回SKIP_BODY，则不执行标签体。</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* SUN公司针对tag接口提供了一个默认的实现类TagSupport，TagSupport类中实现了tag接口的所有方法，</span></span><br><span class="line"><span class="comment">* 因此我们可以编写一个类继承TagSupport类，然后再重写doStartTag方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterationTag_TagSupport_Demo01</span> <span class="keyword">extends</span> <span class="title">TagSupport</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 重写doStartTag方法，控制标签体是否执行</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.TagSupport#doStartTag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       <span class="comment">//如果这个方法返回EVAL_BODY_INCLUDE，则执行标签体，如果返回SKIP_BODY，则不执行标签体</span></span><br><span class="line">       <span class="comment">//return Tag.EVAL_BODY_INCLUDE;</span></span><br><span class="line">       <span class="keyword">return</span> Tag.SKIP_BODY;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/tagSupport"</span> prefix=<span class="string">"tagSupport"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;控制标签体是否执行&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 demo1标签是带有标签体的，标签体的内容是<span class="string">"蒋家腾"</span>这几个字符串--%&gt;</span><br><span class="line">&lt;tagSupport:demo01&gt;</span><br><span class="line">   蒋家腾</span><br><span class="line">&lt;/tagSupport:demo01&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.iterationTag_tagSupport.IterationTag_TagSupport_Demo01<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--demo1标签有标签体，所以这里的body-content设置为JSP--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="控制标签后面的jsp页面是否执行">控制标签后面的jsp页面是否执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.Tag;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.TagSupport;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制整个jsp页面是否执行。</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类实现tag接口，控制doEndTag()方法的返回值，</span></span><br><span class="line"><span class="comment">* 如果这个方法返回EVAL_PAGE，则执行标签余下的jsp页面，如果返回SKIP_PAGE，则不执行余下的jsp。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterationTag_TagSupport_Demo02</span>  <span class="keyword">extends</span> <span class="title">TagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 重写doEndTag方法，控制jsp页面是否执行</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.TagSupport#doEndTag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       <span class="comment">//如果这个方法返回EVAL_PAGE，则执行标签余下的jsp页面，如果返回SKIP_PAGE，则不执行余下的jsp</span></span><br><span class="line">       <span class="comment">//return Tag.SKIP_PAGE;</span></span><br><span class="line">       <span class="keyword">return</span> Tag.EVAL_PAGE;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/tagSupport"</span> prefix=<span class="string">"tagSupport"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;控制jsp页面是否执行&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;jsp页面的内容1&lt;/h1&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 demo2标签是不带标签体的--%&gt;</span><br><span class="line">&lt;tagSupport:demo2/&gt;</span><br><span class="line">&lt;h1&gt;jsp页面的内容2&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.iterationTag_tagSupport.IterationTag_TagSupport_Demo02<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--demo2标签没有标签体，所以这里的body-content设置为empty--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="控制标签体内容重复执行">控制标签体内容重复执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.IterationTag;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.Tag;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.TagSupport;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制jsp页面内容重复执行</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类实现Iterationtag接口，控制doAfterBody()方法的返回值，如果这个方法返回EVAL_BODY_AGAIN，</span></span><br><span class="line"><span class="comment">* 则web服务器又执行一次标签体，依次类推，一直执行到doAfterBody方法返回SKIP_BODY，则标签体才不会重复执行。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterationTag_TagSupport_Demo03</span> <span class="keyword">extends</span> <span class="title">TagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">int</span> x = <span class="number">5</span>;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Tag.EVAL_BODY_INCLUDE;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 控制doAfterBody()方法的返回值，</span></span><br><span class="line"><span class="comment">    * 如果这个方法返回EVAL_BODY_AGAIN， 则web服务器又执行一次标签体，</span></span><br><span class="line"><span class="comment">    * 依次类推，一直执行到doAfterBody方法返回SKIP_BODY，则标签体才不会重复执行。</span></span><br><span class="line"><span class="comment">    * @see javax.servlet.jsp.tagext.TagSupport#doAfterBody()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doAfterBody</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       x--;</span><br><span class="line">       <span class="keyword">if</span>(x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> IterationTag.EVAL_BODY_AGAIN;</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> IterationTag.SKIP_BODY;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/tagSupport"</span> prefix=<span class="string">"tagSupport"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;控制页面内容重复执行5次&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 demo3标签--%&gt;</span><br><span class="line">&lt;tagSupport:demo3&gt;</span><br><span class="line">   &lt;h3&gt;jsp页面的内容&lt;/h3&gt;</span><br><span class="line">&lt;/tagSupport:demo3&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.iterationTag_tagSupport.IterationTag_TagSupport_Demo03<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--demo3标签有标签体，所以这里的body-content设置为JSP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="修改标签体内容输出">修改标签体内容输出</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.BodyContent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.BodyTag;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.BodyTagSupport;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.Tag;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 修改jsp页面内容输出</span></span><br><span class="line"><span class="comment">* 编写一个类实现BodyTag接口，控制doStartTag()方法返回EVAL_BODY_BUFFERED，则web服务器会创建BodyContent对象捕获标签体，</span></span><br><span class="line"><span class="comment">* 然后在doEndTag()方法体内，得到代表标签体的bodyContent对象，从而就可以对标签体进行修改操作。</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* SUN公司针对BodyTag接口提供了一个默认的实现类BodyTagSupport，BodyTagSupport类中实现了BodyTag接口的所有方法，</span></span><br><span class="line"><span class="comment">* 因此我们可以编写一个类继承BodyTagSupport类，然后再根据需要重写doStartTag方法和doEndTag()方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BodyTag_BodyTagSupport_Demo01</span> <span class="keyword">extends</span> <span class="title">BodyTagSupport</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 控制doStartTag()方法返回EVAL_BODY_BUFFERED</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.BodyTagSupport#doStartTag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> BodyTag.EVAL_BODY_BUFFERED;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</span><br><span class="line"> </span><br><span class="line">       <span class="comment">//this.getBodyContent()得到代表标签体的bodyContent对象</span></span><br><span class="line">       BodyContent bodyContent = <span class="keyword">this</span>.getBodyContent();</span><br><span class="line">       <span class="comment">//拿到标签体</span></span><br><span class="line">       String content = bodyContent.getString();</span><br><span class="line">       <span class="comment">//修改标签体里面的内容，将标签体的内容转换成大写</span></span><br><span class="line">       String result = content.toUpperCase();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//输出修改后的内容</span></span><br><span class="line">           <span class="keyword">this</span>.pageContext.getOut().write(result);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">return</span> Tag.EVAL_PAGE;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/bodyTagSupport"</span> prefix=<span class="string">"bodyTagSupport"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;修改jsp页面内容输出&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 demo4标签--%&gt;</span><br><span class="line">&lt;bodyTagSupport:demo1&gt;</span><br><span class="line">   &lt;h3&gt;jjttenger&lt;/h3&gt;</span><br><span class="line">&lt;/bodyTagSupport:demo1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!-- description用来添加对taglib(标签库)的描述 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>jjt开发的自定义标签库_bodyTagSupport<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--taglib(标签库)的版本号 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>JJT_TagLibrary_bodyTag_bodyTagSupport<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       为自定义标签库设置一个uri，uri以/开头，/后面的内容随便写，如这里的/jjt，</span></span><br><span class="line"><span class="comment">       在Jsp页面中引用标签库时，需要通过uri找到标签库</span></span><br><span class="line"><span class="comment">       在Jsp页面中就要这样引入标签库：&lt;%@taglib uri="/jjt" prefix="jjt"%&gt;</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">uri</span>&gt;</span>/bodyTagSupport<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!--一个taglib(标签库)中包含多个自定义标签，每一个自定义标签使用一个tag标记来描述  --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 一个tag标记对应一个自定义标签 --&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.bodyTag_bodyTagSupport.BodyTag_BodyTagSupport_Demo01<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--demo1标签有标签体，所以这里的body-content设置为JSP--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1>简单标签接口开发</h1>
<h2 id="接口及实现类-2">接口及实现类</h2>
<h3 id="SimpleTag接口">SimpleTag接口</h3>
<p>SimpleTag接口是JSP2.0中新增的一个标签接口。由于传统标签使用三个标签接口来完成不同的功能，显得过于繁琐，不利于标签技术的推广，因此，SUN公司为降低标签技术的学习难度，在JSP 2.0中定义了一个更为简单、便于编写和调用的SimpleTag接口。</p>
<p>SimpleTag接口与传统标签接口最大的区别在于，SimpleTag接口只定义了一个用于处理标签逻辑的doTag方法，该方法在WEB容器执行自定义标签时调用，并且只被调用一次。那些使用传统标签接口所完成的功能，例如是否执行标签体、迭代标签体、对标签体内容进行修改等功能都可以在doTag方法中完成。</p>
<p><strong>SimpleTag接口方法介绍</strong></p>
<ul>
<li>setJspContext方法：用于把JSP页面的pageContext对象传递给标签处理器对象</li>
<li>setParent方法：用于把父标签处理器对象传递给当前标签处理器对象</li>
<li>getParent方法：用于获得当前标签的父标签处理器对象</li>
<li>setJspBody方法：用于把代表标签体的JspFragment对象传递给标签处理器对象</li>
<li>doTag方法：用于完成所有的标签逻辑，包括输出、迭代、修改标签体内容等。在doTag方法中可以抛出javax.servlet.jsp.SkipPageException异常，用于通知WEB容器不再执行JSP页面中位于结束标记后面的内容，这等效于在传统标签的doEndTag方法中返回Tag.SKIP_PAGE常量的情况。</li>
</ul>
<h3 id="SimpleTag实现类SimpleTagSupport">SimpleTag实现类SimpleTagSupport</h3>
<p>SUN公司针对SimpleTag接口提供了一个默认的实现类SimpleTagSupport，SimpleTagSupport类中实现了SimpleTag接口的所有方法，因此我们可以编写一个类继承SimpleTagSupport类，然后根据业务需要再重写doTag方法。</p>
<h3 id="JspFragment类：标签体内容输出控制">JspFragment类：标签体内容输出控制</h3>
<p>javax.servlet.jsp.tagext.JspFragment类是在JSP2.0中定义的，它的实例对象代表JSP页面中的一段符合JSP语法规范的JSP片段，这段JSP片段中不能包含JSP脚本元素。</p>
<p>WEB容器在处理简单标签的标签体时，会把标签体内容用一个JspFragment对象表示，并调用标签处理器对象的setJspBody方法把JspFragment对象传递给标签处理器对象。JspFragment类中只定义了两个方法，如下所示：</p>
<p><strong>getJspContext方法</strong></p>
<p>用于返回代表调用页面的JspContext对象。</p>
<p><strong>invoke()方法</strong></p>
<p>public abstract void invoke(java.io.Writer out)：用于执行JspFragment对象所代表的JSP代码片段，参数out用于指定将JspFragment对象的执行结果写入到哪个输出流对象中，如果 传递给参数out的值为null，则将执行结果写入到JspContext.getOut()方法返回的输出流对象中。(简而言之，可以理解为写给浏览器)。</p>
<p>JspFragment.invoke方法是JspFragment最重要的方法，利用这个方法可以控制是否执行和输出标签体的内容、是否迭代执行标签体的内容或对标签体的执行结果进行修改后再输出。例如：</p>
<ul>
<li>在标签处理器中如果没有调用JspFragment.invoke方法，其结果就相当于忽略标签体内容；</li>
<li>在标签处理器中重复调用JspFragment.invoke方法，则标签体内容将会被重复执行；</li>
</ul>
<p>若想在标签处理器中修改标签体内容，只需在调用invoke方法时指定一个可取出结果数据的输出流对象（例如StringWriter），让标签体的执行结果输出到该输出流对象中，然后从该输出流对象中取出数据进行修改后再输出到目标设备，即可达到修改标签体的目的。</p>
<h2 id="自定义标签属性">自定义标签属性</h2>
<p>自定义标签可以定义一个或多个属性，这样，在JSP页面中应用自定义标签时就可以设置这些属性的值，通过这些属性为标签处理器传递参数信息，从而提高标签的灵活性和复用性。</p>
<p>要想让一个自定义标签具有属性，通常需要完成两个任务：</p>
<ul>
<li>在标签处理器中编写每个属性对应的setter方法；</li>
<li>在TLD文件中定义标签的属性。</li>
</ul>
<p>为自定义标签定义属性时，每个属性都必须按照JavaBean的属性命名方式，在标签处理器中定义属性名对应的setter方法，用来接收JSP页面调用自定义标签时传递进来的属性值。 例如属性url，在标签处理器类中就要定义相应的setUrl(String url)方法。</p>
<p>在标签处理器中定义相应的set方法后，JSP引擎在解析执行开始标签前，也就是调用doStartTag方法前，会调用set属性方法，为标签设置属性。</p>
<p>如果标签的属性值是8种基本数据类型，那么在JSP页面在传递字符串时，JSP引擎会自动转换成相应的类型。但如果标签的属性值是复合数据类型，那么JSP引擎是无法自动转换的。如果一定要给标签的复合属性赋值，那么可以采用表达式的方式给复合属性赋值。</p>
<h2 id="简单标签的执行过程">简单标签的执行过程</h2>
<p>当web容器开始执行标签时，会调用如下方法完成标签的初始化：</p>
<ul>
<li>WEB容器调用标签处理器对象的setJspContext方法，将代表JSP页面的pageContext对象传递给标签处理器对象。</li>
<li>WEB容器调用标签处理器对象的setParent方法，将父标签处理器对象传递给这个标签处理器对象。注意，只有在标签存在父标签的情况下，WEB容器才会调用这个方法。</li>
<li>如果调用标签时设置了属性，容器将调用每个属性对应的setter方法把属性值传递给标签处理器对象。如果标签的属性值是EL表达式或脚本表达式，则WEB容器首先计算表达式的值，然后把值传递给标签处理器对象。</li>
<li>如果简单标签有标签体，WEB容器将调用setJspBody方法把代表标签体的JspFragment对象传递进来。</li>
<li>执行标签时WEB容器调用标签处理器的doTag()方法，开发人员在方法体内通过操作JspFragment对象，就可以实现是否执行、迭代、修改标签体的目的。</li>
</ul>
<h2 id="简单标签开发示例">简单标签开发示例</h2>
<h3 id="控制标签体是否执行-2">控制标签体是否执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.JspFragment;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制jsp页面某一部分内容是否执行</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类继承SimpleTagSupport，然后再重写doTag方法，在doTag方法里面不调用jspFrament.invoke方法即可。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_SimpleTagSupport_Demo01</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">     * 重写doTag方法，控制标签体是否执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">//得到代表jsp标签体的JspFragment</span></span><br><span class="line">       JspFragment jspFragment = <span class="keyword">this</span>.getJspBody();</span><br><span class="line"> </span><br><span class="line">       <span class="comment">//得到jsp页面的的PageContext对象</span></span><br><span class="line">       <span class="comment">//PageContext pageContext = (PageContext) jspFragment.getJspContext();</span></span><br><span class="line">       <span class="comment">//调用JspWriter将标签体的内容输出到浏览器</span></span><br><span class="line">       <span class="comment">//jspFragment.invoke(pageContext.getOut());</span></span><br><span class="line"> </span><br><span class="line">       <span class="comment">//将标签体的内容输出到浏览器</span></span><br><span class="line">       jspFragment.invoke(<span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpleTagSupport"</span> prefix=<span class="string">"simpleTag"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;用简单标签控制标签体是否执行&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 demo1标签是带有标签体的，标签体的内容是<span class="string">"jjtenger"</span>这几个字符串--%&gt;</span><br><span class="line">&lt;simpleTag:demo1&gt;</span><br><span class="line">   jjtenger</span><br><span class="line">&lt;/simpleTag:demo1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>SimpleTag(简单标签)Demo1<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       为标签处理器类配一个标签名，在Jsp页面中使用标签时是通过标签名来找到要调用的标签处理器类的</span></span><br><span class="line"><span class="comment">       通过demo1就能找到对应的me.gacl.web.simpletag.SimpleTagDemo1类</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签对应的处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_SimpleTagSupport_Demo01<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   tld文件中有四种标签体类型 ：empty  JSP  scriptless  tagdepentend</span></span><br><span class="line"><span class="comment">       在简单标签(SampleTag)中标签体body-content的值只允许是empty和scriptless，不允许设置成JSP,如果设置成JSP就会出现异常</span></span><br><span class="line"><span class="comment">       在传统标签中标签体body-content的值只允许是empty和JSP</span></span><br><span class="line"><span class="comment">       如果标签体body-content的值设置成tagdepentend，那么就表示标签体里面的内容是给标签处理器类使用的，</span></span><br><span class="line"><span class="comment">       例如：开发一个查询用户的sql标签，此时标签体中的SQL语句就是给SQL标签的标签处理器来使用的</span></span><br><span class="line"><span class="comment">       &lt;gacl:sql&gt;SELECT * FROM USER&lt;/gacl:sql&gt;</span></span><br><span class="line"><span class="comment">       在这种情况下，sql标签的&lt;body-content&gt;就要设置成tagdepentend，tagdepentend用得比较少，了解一下即可</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>例如：开发一个查询用户的sql标签，此时标签体中的SQL语句就是给SQL标签的标签处理器来使用的</p>
<h3 id="控制标签体内容重复执行-2">控制标签体内容重复执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.JspFragment;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制jsp页面内容重复执行</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类继承SimpleTagSupport，然后再重写doTag方法，在doTag方法里面重复调用jspFrament.invoke方法即可。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_SimpleTagSupport_Demo02</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">     * 重写doTag方法，控制标签执行5次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">// 得到代表jsp标签体的JspFragment</span></span><br><span class="line">       JspFragment jspFragment = <span class="keyword">this</span>.getJspBody();</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">           <span class="comment">// 将标签体的内容输出到浏览器</span></span><br><span class="line">           jspFragment.invoke(<span class="keyword">null</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpleTagSupport"</span> prefix=<span class="string">"simpleTag"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;用简单标签控制标签体执行5次&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 --%&gt;</span><br><span class="line">&lt;simpleTag:demo2&gt;</span><br><span class="line">   jjtenger&lt;p/&gt;</span><br><span class="line">&lt;/simpleTag:demo2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_SimpleTagSupport_Demo02<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签体允许的内容 ，scriptless表示标签体的内容不允许是java脚本代码--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="修改标签体内容输出-2">修改标签体内容输出</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.PageContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.JspFragment;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 修改jsp页面内容输出</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类继承SimpleTagSupport，然后再重写doTag方法，在doTag方法调用jspFrament.invoke方法时，让执行结果写一个自定义的缓冲中即可，</span></span><br><span class="line"><span class="comment">* 然后开发人员可以取出缓冲的数据修改输出。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_SimpleTagSupport_Demo03</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">     * 重写doTag方法，修改标签体里面的内容，将标签体的内容转换成大写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">// 得到代表jsp标签体的JspFragment</span></span><br><span class="line">       JspFragment jspFragment = <span class="keyword">this</span>.getJspBody();</span><br><span class="line">       StringWriter sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line">       <span class="comment">//将标签体的内容写入到sw流中</span></span><br><span class="line">       jspFragment.invoke(sw);</span><br><span class="line">       <span class="comment">//获取sw流缓冲区的内容</span></span><br><span class="line">       String content = sw.getBuffer().toString();</span><br><span class="line">       content = content.toUpperCase();</span><br><span class="line">       PageContext pageContext = (PageContext) <span class="keyword">this</span>.getJspContext();</span><br><span class="line">       <span class="comment">//将修改后的content输出到浏览器中</span></span><br><span class="line">       pageContext.getOut().write(content);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%--&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpletag"</span> prefix=<span class="string">"gacl"</span> %&gt;--%&gt;</span><br><span class="line">&lt;%--在jsp页面中也可以使用这种方式导入标签库，直接把uri设置成标签库的tld文件所在目录 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/WEB-INF/jsp_tag_tld/simpleTag_simpleTagSupport/simpleTag_simpleTagSupport.tld"</span> prefix=<span class="string">"simpleTag"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;用简单标签修改jsp页面内容输出&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 --%&gt;</span><br><span class="line">&lt;simpleTag:demo3&gt;</span><br><span class="line">   jjtenger</span><br><span class="line">&lt;/simpleTag:demo3&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_SimpleTagSupport_Demo03<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签体允许的内容 ，scriptless表示标签体的内容不允许是java脚本代码--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="控制标签后面的jsp页面是否执行-2">控制标签后面的jsp页面是否执行</h3>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.SkipPageException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 控制整个jsp页面是否执行</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 编写一个类继承SimpleTagSupport，然后再重写doTag方法，在doTag方法抛出SkipPageException异常即可，</span></span><br><span class="line"><span class="comment">* jsp收到这个异常，将忽略标签余下jsp页面的执行。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_SimpleTagSupport_Demo04</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span></span>&#123;</span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">     * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">     * 重写doTag方法，控制标签余下的Jsp不执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">//抛出一个SkipPageException异常就可以控制标签余下的Jsp不执行</span></span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> SkipPageException();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%--&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpletag"</span> prefix=<span class="string">"gacl"</span> %&gt;--%&gt;</span><br><span class="line">&lt;%--在jsp页面中也可以使用这种方式导入标签库，直接把uri设置成标签库的tld文件所在目录 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/WEB-INF/jsp_tag_tld/simpleTag_simpleTagSupport/simpleTag_simpleTagSupport.tld"</span> prefix=<span class="string">"simpleTag"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;用简单标签控制标签余下的Jsp不执行&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;jjtenger&lt;/h1&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签 --%&gt;</span><br><span class="line">&lt;simpleTag:demo4/&gt;</span><br><span class="line">&lt;!-- 这里的内容位于 &lt;simpleTag:demo4/&gt;标签后面，因此不会输出到页面上 --&gt;</span><br><span class="line">&lt;h1&gt;白虎神皇&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo4<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_SimpleTagSupport_Demo04<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签体允许的内容 ，empty表示该标签没有标签体--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="开发带属性的标签">开发带属性的标签</h3>
<p><strong>通过属性控制标签体的执行次数</strong></p>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过标签的属性控制标签体的执行次数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_Attribute_Demo01</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 定义标签的属性</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">   <span class="comment">/**count属性对应的set方法</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> count</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.count = count;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">    * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">    * 重写doTag方法，通过标签的属性控制标签体的执行次数</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">           <span class="keyword">this</span>.getJspBody().invoke(<span class="keyword">null</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%--&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpletag"</span> prefix=<span class="string">"gacl"</span> %&gt;--%&gt;</span><br><span class="line">&lt;%--在jsp页面中也可以使用这种方式导入标签库，直接把uri设置成标签库的tld文件所在目录 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpleTagSupport"</span> prefix=<span class="string">"simpleTag"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;通过标签的属性控制标签体的执行次数&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--在jsp页面中使用自定义标签，标签有一个count属性 --%&gt;</span><br><span class="line">&lt;simpleTag:attribute_demo01 count=<span class="string">"10"</span>&gt;</span><br><span class="line">   &lt;h1&gt;jjtenger&lt;/h1&gt;</span><br><span class="line">&lt;/simpleTag:attribute_demo01&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>attribute_demo01<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_Attribute_Demo01<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签体允许的内容--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签的属性描述 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">description</span>&gt;</span>描述标签的count属性<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 标签的count属性 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- rtexprvalue用来指示标签的属性值是否可以是一个表达式，</span></span><br><span class="line"><span class="comment">       一般设置为true,true就表示允许标签的属性值可以是一个表达式--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>使用表达式给复合属性赋值</strong></p>
<ol>
<li>JAVA代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 标签接收的属性值是一个复合数据类型，该如何给标签的属性赋值。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTag_Attribute_Demo02</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 定义标签的属性</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Date date;</span><br><span class="line">   <span class="comment">/**date属性对应的set方法</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.date = date;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* 简单标签使用这个方法就可以完成所有的业务逻辑</span></span><br><span class="line"><span class="comment">    * @see javax.servlet.jsp.tagext.SimpleTagSupport#doTag()</span></span><br><span class="line"><span class="comment">    * 重写doTag方法，输出date属性值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.getJspContext().getOut().write(date.toLocaleString());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSP测试页面</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%--在jsp页面中导入自定义标签库 --%&gt;</span><br><span class="line">&lt;%--&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpletag"</span> prefix=<span class="string">"gacl"</span> %&gt;--%&gt;</span><br><span class="line">&lt;%--在jsp页面中也可以使用这种方式导入标签库，直接把uri设置成标签库的tld文件所在目录 --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/simpleTagSupport"</span> prefix=<span class="string">"simpleTag"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;如果标签接收的属性值是一个复合数据类型，该如何给标签的属性赋值&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">在jsp页面中使用自定义标签，标签有一个date属性 ，是一个复合数据类型</span><br><span class="line"> 如果标签的属性值是<span class="number">8</span>种基本数据类型，那么在JSP页面在传递字符串时，JSP引擎会自动转换成相应的类型</span><br><span class="line"> 但如果标签的属性值是复合数据类型，那么JSP引擎是无法自动转换的，</span><br><span class="line"> 这里将一个字符串赋值给demo6标签的date属性，在运行标签时就会出现如下错误：</span><br><span class="line">Unable to convert string "1988-05-07" to class "java.util.Date" for attribute "date":</span><br><span class="line">Property Editor not registered with the PropertyEditorManager</span><br><span class="line">    &lt;simpleTag:attribute_demo02 date=<span class="string">"1988-05-07"</span>&gt;</span><br><span class="line">    &lt;/simpleTag:attribute_demo02&gt;</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%--如果一定要给标签的复合属性赋值，那么可以采用表达式的方式给复合属性赋值，如下所示： --%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">   Date d = <span class="keyword">new</span> Date();</span><br><span class="line">   request.setAttribute(<span class="string">"date"</span>, d);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;simpleTag:attribute_demo02 date=<span class="string">"$&#123;date&#125;"</span>/&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;simpleTag:attribute_demo02 date=<span class="string">"&lt;%=new Date()%&gt;"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>tld配置文件部分</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>attribute_demo02<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>_4_JSP.jsp_tag.custom_tag.demo.simpleTag_simpleTagSupport.SimpleTag_Attribute_Demo02<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签体允许的内容--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 标签的属性描述 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">description</span>&gt;</span>描述标签的date属性<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 标签的date属性，复合数据类型 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>date<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- rtexprvalue用来指示标签的属性值是否可以是一个表达式，</span></span><br><span class="line"><span class="comment">       一般设置为true,true就表示允许标签的属性值可以是一个表达式--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1>引入标签库</h1>
<ol>
<li>
<p>标签库的uri不能设置为相同，否则不能确定到底引用哪一个标签库。</p>
</li>
<li>
<p>可以将uri设置为标签库的tld文件路径：</p>
</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"要引用的标签库的tld文件路径"</span> prefix=<span class="string">"gacl"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<ul>
<li>引用gacl.tld标签库：</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/WEB-INF/gacl.tld"</span> prefix=<span class="string">"gacl"</span>%&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>引用simpletag.tld标签库：</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"/WEB-INF/simpletag.tld"</span> prefix=<span class="string">"gacl"</span>%&gt;</span><br></pre></td></tr></table></figure>
<h1>TLD文件配置标签</h1>
<p>我们开发一个标签后，需要在tld文件中添加对该标签的定义，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>me.gacl.web.simpletag.SimpleTagDemo2<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签体允许的内容 ，scriptless表示标签体的内容不允许是java脚本代码--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ld文件中使用 <code>&lt;tag&gt;</code> 来描述一个标签，描述的内容包括标签名(name)，标签处理器类(tag-class)，标签体的内容(body-content)。</p>
<p>tld文件中有四种标签体(body-content)类型 ：empty、JSP、scriptless、tagdependent 。</p>
<ul>
<li><strong>简单标签标签体类型设置</strong></li>
</ul>
<p>在简单标签(SampleTag)中标签体body-content的值只允许是empty、scriptless、tagdependent，不允许设置成JSP,如果设置成JSP就会出现异常：</p>
<p>The TLD for the class me.gacl.web.simpletag.SimpleTagDemo1 specifies an invalid body-content (JSP) for a SimpleTag</p>
<p>body-content的值如果设置成empty，那么就表示该标签没有标签体，如果是设置成scriptless，那么表示该标签是有标签体的，但是标签体中的内容不可以是 <code>&lt;%java代码%&gt;</code> ，例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;gacl:xdpdemo1&gt;</span><br><span class="line">   &lt;%</span><br><span class="line">        <span class="comment">//嵌套在标签体中的java代码</span></span><br><span class="line">        <span class="keyword">int</span> i= <span class="number">0</span>;</span><br><span class="line">    %&gt;</span><br><span class="line">      孤傲苍狼</span><br><span class="line">&lt;/gacl:xdpdemo1&gt;</span><br></pre></td></tr></table></figure>
<p>否则运行标签时就会出现如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scripting elements ( &lt;%!, &lt;jsp:declaration, &lt;%=, &lt;jsp:expression, &lt;%, &lt;jsp:scriptlet ) are disallowed here</span><br></pre></td></tr></table></figure>
<p>jsp标签技术出现的目的就是为了移除在jsp页面上编写的java代码的，如果在jsp标签中允许出现java代码，那么就违背了jsp标签技术设计时的初衷了。所以在简单标签的标签体中是不允许出现java代码的。</p>
<ul>
<li><strong>传统标签标签体类型设置</strong></li>
</ul>
<p>在传统标签中标签体body-content的值允许是empty、JSP、scriptless、tagdependent，body-content的值如果是设置成JSP，那么表示该标签是有标签体的，并且标签体的内容可以是任意的，包括java代码，如果是设置成scriptless，那么表示该标签是有标签体的，但是标签体的内容不能是java代码。</p>
<p>如果传统标签和简单标签的标签体body-content的值设置成tagdependent，那么就表示标签体里面的内容是给标签处理器类使用的，tagdependent用得比较少，了解一下即可。</p>
<ul>
<li><strong>定义标签属性</strong></li>
</ul>
<p><code>&lt;tag&gt;</code> 元素的 <code>&lt;attribute&gt;</code> 子元素用于描述自定义标签的一个属性，自定义标签所具有的每个属性都要对应一个 <code>&lt;attribute&gt;</code> 元素</p>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo5<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签处理器类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>me.gacl.web.simpletag.SimpleTagDemo5<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签体允许的内容--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签的属性描述 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>描述标签的count属性<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 标签的count属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- rtexprvalue用来指示标签的属性值是否可以是一个表达式，</span></span><br><span class="line"><span class="comment">        一般设置为true,true就表示允许标签的属性值可以是一个表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;attribute&gt;</code> 元素的子元素说明见下图。</p>
<p><img src="https://hexo-1300861231.cos.ap-shanghai.myqcloud.com/1584775788_20200321152136088_16650.png" alt></p>

      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/quotes/">QUOTES</a></li>
            <li><a href="/quotes/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">JAVAWEB学习笔记</a></li>
            <li>13-JSP自定义标签</li>
          
  </ul>

    
    
    
  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">相关API类继承关系</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JspTag接口"><span class="nav-text">JspTag接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">传统标签接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#接口及实现类"><span class="nav-text">接口及实现类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tag接口"><span class="nav-text">Tag接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IterationTag接口"><span class="nav-text">IterationTag接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IterationTag实现类TagSupport"><span class="nav-text">IterationTag实现类TagSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BodyTag接口"><span class="nav-text">BodyTag接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BodyTag实现类BodyTagSupport"><span class="nav-text">BodyTag实现类BodyTagSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BodyContent对象"><span class="nav-text">BodyContent对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#传统标签接口方法返回值总结"><span class="nav-text">传统标签接口方法返回值总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传统标签开发步骤"><span class="nav-text">传统标签开发步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传统标签的执行过程分析"><span class="nav-text">传统标签的执行过程分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传统标签接口开发示例"><span class="nav-text">传统标签接口开发示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签体是否执行"><span class="nav-text">控制标签体是否执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签后面的jsp页面是否执行"><span class="nav-text">控制标签后面的jsp页面是否执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签体内容重复执行"><span class="nav-text">控制标签体内容重复执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改标签体内容输出"><span class="nav-text">修改标签体内容输出</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">简单标签接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#接口及实现类-2"><span class="nav-text">接口及实现类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SimpleTag接口"><span class="nav-text">SimpleTag接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SimpleTag实现类SimpleTagSupport"><span class="nav-text">SimpleTag实现类SimpleTagSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JspFragment类：标签体内容输出控制"><span class="nav-text">JspFragment类：标签体内容输出控制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义标签属性"><span class="nav-text">自定义标签属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单标签的执行过程"><span class="nav-text">简单标签的执行过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单标签开发示例"><span class="nav-text">简单标签开发示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签体是否执行-2"><span class="nav-text">控制标签体是否执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签体内容重复执行-2"><span class="nav-text">控制标签体内容重复执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改标签体内容输出-2"><span class="nav-text">修改标签体内容输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制标签后面的jsp页面是否执行-2"><span class="nav-text">控制标签后面的jsp页面是否执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开发带属性的标签"><span class="nav-text">开发带属性的标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">引入标签库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">TLD文件配置标签</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="jiateng.jiang"
    src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">jiateng.jiang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiateng.jiang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  






  <script src="/js/local-search.js"></script>








<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '100%'
      });
    });
  }, window.PDFObject);
}
</script>





  

  

  

</body>
</html>
